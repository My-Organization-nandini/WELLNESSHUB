<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Chat Assistant</title>
    <style>

    </style>
    <link rel="stylesheet" href="css/ChatUI.css">

    <style>
                :root {
            --primary-color: #4caf50;
            --secondary-color: #f9f9f9;
            --text-color: #2f2f2f;
            --sidebar-color: #ffffff;
            --hover-color: #43a047;
            --border-color: #ccc;
            --bot-message-bg: #f0f0f0;
            --user-message-bg: #ffffff;
            --error-color: #dc2626;
            --input-glow: rgba(76, 175, 80, 0.3);
            --input-bg: rgba(248, 250, 252, 0.95);
            --button-hover-bg: #e6f4ea;
            --base-font-size: 14px;
            --heading-font-size: 1.8rem;
            --input-font-size: 13px;
            --menu-font-size: 12px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Poppins', sans-serif;
        }

        body {
            display: flex;
            height: 100vh;
            overflow: hidden;
            color: var(--text-color);
            background: linear-gradient(135deg, #f9f9f9, #e0e0e0);
            font-size: var(--base-font-size);
        }

        /* Left Sidebar (Desktop) */
        .sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 70px;
            height: 100%;
            background-color: var(--sidebar-color);
            z-index: 100;
            display: flex;
            flex-direction: column;
            align-items: center;
            transition: width 0.3s ease;
        }
.login-btn {
    position: fixed;
    top: 15px;
    right: 20px;
    background: #4caf50;
    color: white;
    padding: 8px 16px;
    border-radius: 8px;
    text-decoration: none;
    font-size: 14px;
    z-index: 3000; /* âœ… keeps it visible on top */
}
.login-btn:hover {
    background: #43a047;
}




        .logo {
            margin-top: 1.5rem;
            margin-bottom: 2rem;
            width: 40px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
        }

        .logo svg {
            width: 100%;
            height: 100%;
            stroke: var(--primary-color);
        }

        .add-btn {
            width: 40px;
            height: 40px;
            background-color: var(--primary-color);
            border: none;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 2rem;
            cursor: pointer;
            color: #fff;
            font-size: 1.5rem;
            transition: background-color 0.2s;
        }

        .add-btn:hover {
            background-color: var(--hover-color);
        }

        .nav-menu {
            list-style: none;
            width: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .nav-item {
            width: 100%;
            margin-bottom: 1rem;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .nav-link {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
            padding: 0.75rem 0;
            color: #b0b0b0;
            text-decoration: none;
            transition: all 0.2s;
            font-size: var(--menu-font-size);
        }

        .nav-link.active {
            color: var(--text-color);
        }

        .nav-link:hover {
            color: var(--text-color);
        }

        .nav-icon {
            margin-bottom: 0.35rem;
            font-size: 1.4rem;
            text-align: center;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .nav-icon svg {
            width: 100%;
            height: 100%;
            stroke: currentColor;
            fill: none;
        }

        /* User Account Icon */
        .user-account {
            margin-top: auto;
            margin-bottom: 1rem;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
            cursor: pointer;
            position: relative;
        }

        .user-account img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-dropdown {
            position: fixed;
            bottom: 60px;
            left: 70px;
            width: 200px;
            background-color: #d7d7d7;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.3);
            display: none;
            flex-direction: column;
            z-index: 99;
        }

        .user-dropdown.active {
            display: flex;
        }

        .user-dropdown-item {
            padding: 12px 16px;
            color: #333;
            text-decoration: none;
            font-size: var(--menu-font-size);
            transition: background-color 0.2s;
            display: flex;
            align-items: center;
            gap: 10px;
            position: relative;
        }

        .user-dropdown-item:hover {
            background-color: var(--hover-color);
        }

        .user-dropdown-item:hover::after {
            content: attr(data-tooltip);
            position: absolute;
            left: 100%;
            margin-left: 10px;
            background-color: #b0b0b0;
            color: #fff;
            padding: 5px 10px;
            border-radius: 4px;
            font-size: 12px;
            white-space: nowrap;
            z-index: 100;
        }

        /* Expanded Sidebar (Desktop) */
        .expanded-menu {
            position: fixed;
            top: 0;
            left: 70px;
            width: 250px;
            height: 100%;
            background-color: #fefefe;
            overflow-y: auto;
            z-index: 95;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.3);
            padding-top: 1rem;
            border-left: 1px solid var(--border-color);
        }

        .sidebar:hover+.expanded-menu,
        .expanded-menu:hover {
            transform: translateX(0);
        }

        .expanded-menu-title {
            padding: 1rem 1.5rem;
            font-size: 1.2rem;
            font-weight: 600;
            color: #333;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid var(--border-color);
        }

        .expanded-menu-title svg {
            width: 18px;
            height: 18px;
        }

        .expanded-menu-list {
            list-style: none;
        }

        .expanded-menu-item {
            padding: 12px 16px;
            font-size: var(--menu-font-size);
            line-height: 1.3;
            border-bottom: 1px solid #eee;
            transition: background-color 0.2s ease;
        }

        .expanded-menu-item span {
            font-size: var(--menu-font-size);
            font-weight: 500;
            color: #333;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 200px;
        }

        .expanded-menu-item:hover {
            background-color: #f0f0f0;
        }

        .expanded-menu-item.active {
            background-color: #e8f5e9;
            font-weight: bold;
        }

        /* Mobile Sidebar (Drawer) */
        .mobile-sidebar {
            position: fixed;
            top: 0;
            left: 0;
            width: 280px;
            height: 100%;
            background-color: var(--sidebar-color);
            z-index: 1000;
            transform: translateX(-100%);
            transition: transform 0.3s ease;
            display: none;
            flex-direction: column;
            padding: 1rem;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.2);
        }

        .mobile-sidebar.active {
            transform: translateX(0);
        }

        .mobile-sidebar-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.3);
            z-index: 999;
            display: none;
        }

        .mobile-sidebar-overlay.active {
            display: block;
        }

        .mobile-sidebar-header {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 0.5rem 1rem;
        }

        .mobile-sidebar .logo {
            margin: 0;
        }

        .mobile-new-chat-btn {
            width: 90%;
            padding: 8px;
            background: #fff;
            border: 2px dashed #43a047;
            border-radius: 8px;
            color: #43a047;
            font-size: 1rem;
            cursor: pointer;
            text-align: center;
            margin: 0.7rem 0;
            margin-left: 13px;
            margin-top: -10px;
            margin-bottom: 15px;
        }

        .mobile-sidebar .nav-menu {
            flex-direction: column;
            align-items: flex-start;
            padding: 0 1rem;
        }

        .mobile-sidebar .nav-item {
            width: 100%;
            margin-bottom: 0.5rem;
        }

        .mobile-sidebar .nav-link {
            flex-direction: row;
            align-items: center;
            padding: 0.5rem;
            font-size: 1rem;
        }

        .mobile-sidebar .nav-icon {
            margin-bottom: 0;
            margin-right: 0.5rem;
        }

        .mobile-sidebar .expanded-menu {
            position: static;
            width: 100%;
            transform: none;
            box-shadow: none;
            border-left: none;
            padding-top: 0;
        }

        .mobile-sidebar .expanded-menu-title {
            font-size: 1rem;
            padding: 0.5rem 1rem;
        }

        .mobile-sidebar .expanded-menu-item {
            padding: 10px 1rem;
            font-size: 0.9rem;
        }

        .tools-section {
            padding: 0 1rem;
            margin-top: 1rem;
        }

        .tools-section h3 {
            font-size: 0.9rem;
            font-weight: 600;
            color: #333;
            margin-bottom: 0.5rem;
        }

        .tools-section ul {
            list-style: none;
        }

        .tools-section li {
            font-size: 0.8rem;
            color: #666;
            padding: 0.5rem 0;
            cursor: pointer;
        }

        .tools-section li:hover {
            color: var(--primary-color);
        }

        /* Hamburger Menu */
        .hamburger-menu {
            position: fixed;
            top: 10px;
            left: 10px;
            z-index: 1100;
            background-color: #ffffff;
            border: 1px solid #d1d5db;
            border-radius: 6px;
            padding: 8px;
            cursor: pointer;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            transition: background-color 0.2s, transform 0.2s;
        }

        .hamburger-menu:hover {
            background-color: #f3f4f6;
            transform: scale(1.05);
        }

        .hamburger-menu svg {
            width: 24px;
            height: 24px;
            stroke: var(--text-color);
        }

        /* Main Content */
        .main {
            flex: 1;
            display: flex;
            flex-direction: column;
            background-color: #ffffff;
            position: relative;
            margin-left: 70px;
        }

        .main.shifted-left {
            margin-left: 280px;
            transition: margin-left 0.3s ease;
        }

        .page-content {
            flex: 1;
            overflow-y: auto;
            position: relative;
        }

        /* Chat Interface */
        .chat-interface {
            display: flex;
            flex-direction: column;
            height: 100%;
        }

       /* Model Selector */
.model-selector {
    position: absolute;
    top: 10px;
    left: 50%;
    transform: translateX(-50%);
    background-color: #ffffff;
    border: 1px solid var(--border-color);
    border-radius: 12px; /* slightly smaller */
    padding: 2px 8px; /* less padding for compact look */
    display: flex;
    justify-content: center; /* center the option */
    z-index: 1000;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    width: fit-content; /* shrink to fit content */
}

/* Noira Option */
.model-option {
    padding: 6px 12px; /* smaller button size */
    font-size: 14px;   /* adjust text size */
    cursor: pointer;
    border-radius: 12px;
    background-color: #ffffff;
    border: 1px solid var(--border-color);
    transition: all 0.2s ease;
}

.model-option.active {
    background-color: #f0f0f0; /* highlight active */
}

        /* Chat Area */
       .chat-area {
        margin-left: 100px;
}

        .message-container {
            max-width: 50rem;
            margin: 0 auto;
            padding: 10px 20px;
            display: flex;
            align-items: flex-start;
        }

        .bot-message {
            justify-content: flex-start;
            background-color: #ffffff;
        }

        .user-message {
            justify-content: flex-end;
            background-color: var(--user-message-bg);
        }

        .message-wrapper {
            max-width: 70%;
            display: flex;
            align-items: flex-start;
        }

        .bot-message .message-wrapper {
            flex-direction: row;
        }

        .user-message .message-wrapper {
            flex-direction: row-reverse;
        }

        .user-message .message-content {
            background-color: #4CAF50;
            color: #FFFFFF;
        }

        .avatar {
            width: 28px;
            height: 28px;
            border-radius: 2px;
            background-color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #ffffff;
            font-size: var(--menu-font-size);
            flex-shrink: 0;
            margin: 0 10px;
        }

        .user-avatar-chat {
            background-color: #ffffff;
            color: #ffffff;
        }

        .message-content {
            line-height: 1.5;
            font-size: var(--base-font-size);
            padding: 10px;
            border-radius: 8px;
            background: inherit;

            /* âœ… Fix long word wrapping */
            word-break: break-word;
            white-space: pre-wrap;
            overflow-wrap: anywhere;
        }


        /* Input Area */
        .input-area {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 10px 0 30px;
            display: flex;
            flex-direction: column;
            align-items: center;
            background: linear-gradient(to top, #ffffff 60%, rgba(255, 255, 255, 0));
        }

        .input-container {
            position: relative;
            width: 90%;
            max-width: 50rem;
            display: flex;
            align-items: center;
            gap: 10px;
            background: var(--input-bg);
            border-radius: 12px;
            padding: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
            transition: box-shadow 0.3s ease;
        }

        .input-container:hover {
            box-shadow: 0 6px 16px var(--input-glow);
        }

        .input-buttons-left {
            display: flex;
            gap: 8px;
        }

        .input-buttons-right {
            display: flex;
            gap: 8px;
            position: absolute;
            right: 10px;
            bottom: 10px;
        }

        .input-button {
            background-color: transparent;
            border: none;
            cursor: pointer;
            color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            transition: background-color 0.3s, transform 0.2s;
        }

        .input-button:hover {
            background-color: var(--button-hover-bg);
            transform: scale(1.1);
        }

        .input-button svg {
            width: 20px;
            height: 20px;
        }

        .chat-input {
            flex: 1;
            padding: 12px 90px 12px 12px;
            border: none;
            border-radius: 8px;
            font-size: var(--input-font-size);
            resize: none;
            background: transparent;
            outline: none;
            max-height: 200px;
            overflow-y: auto;
        }

        .chat-input:focus {
            border: none;
            box-shadow: none;
        }

        .send-button {
            background-color: var(--primary-color);
            border: none;
            cursor: pointer;
            color: #ffffff;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 36px;
            height: 36px;
            border-radius: 8px;
            transition: background-color 0.3s, transform 0.2s;
        }

        .send-button:hover {
            background-color: var(--hover-color);
            transform: scale(1.1);
        }

        .send-button svg {
            width: 20px;
            height: 20px;
        }

        /* Welcome Screen */
        .welcome-screen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 20px;
            text-align: center;
        }

        .welcome-title {
            font-size: var(--heading-font-size);
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .examples-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            max-width: 600px;
            margin-top: 30px;
        }

        .example-card {
            background-color: #ffffff;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 12px;
            cursor: pointer;
            width: 280px;
            text-align: left;
            transition: border-color 0.2s;
        }

        .example-card:hover {
            border-color: var(--primary-color);
        }

        .example-title {
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
            font-size: var(--base-font-size);
        }

        .example-text {
            color: #666;
            font-size: var(--menu-font-size);
        }

        /* DreamSpace Page */
        .dreamspace-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 20px;
            text-align: center;
        }

        .dreamspace-page h2 {
            font-size: var(--heading-font-size);
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .dreamspace-page p {
            font-size: var(--base-font-size);
            color: #666;
            max-width: 600px;
            margin-bottom: 30px;
        }

        .dreamspace-page button {
            background-color: var(--primary-color);
            color: #fff;
            border: none;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: var(--base-font-size);
            cursor: pointer;
            transition: background-color 0.2s;
        }

        .dreamspace-page button:hover {
            background-color: var(--hover-color);
        }

        /* SoulSafe Page */
        .soulsafe-page {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100%;
            padding: 20px;
            text-align: center;
        }

        .soulsafe-page h2 {
            font-size: var(--heading-font-size);
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--text-color);
        }

        .soulsafe-page p {
            font-size: var(--base-font-size);
            color: #666;
            max-width: 600px;
            margin-bottom: 30px;
        }

        .soulsafe-page textarea {
            width: 100%;
            max-width: 600px;
            height: 150px;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: var(--base-font-size);
            resize: vertical;
            background: #f0f0f0;
        }

        .soulsafe-page textarea:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.2);
        }

        .delete-btn {
            background: none;
            border: none;
            color: #b0b0b0;
            cursor: pointer;
            padding: 0 8px;
            display: flex;
            align-items: center;
        }

        .delete-btn:hover {
            color: var(--error-color);
        }

        .delete-btn svg {
            width: 16px;
            height: 16px;
        }

        .expanded-menu.pinned {
            transform: translateX(0) !important;
        }

        .pin-icon {
            background: none;
            padding: 0;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s ease;
        }

        .pin-icon svg {
            stroke: #999;
            fill: none;
            transition: stroke 0.3s ease, fill 0.3s ease;
        }

        .pin-icon:hover svg {
            stroke: #4CAF50;
        }

        .expanded-menu.pinned .pin-icon svg {
            fill: #4CAF50;
            stroke: #4CAF50;
        }

        .expanded-menu.pinned .pin-icon {
            transform: translateX(-4px) rotate(-15deg);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .chat-area {
                padding-top: 80px;
                /* Increase top padding to account for model-selector */
            }

            .model-selector {
                position: fixed;
                top: 60px;
                /* Adjusted to avoid overlap with hamburger menu */
                left: 50%;
                transform: translateX(-50%);
                width: 90%;
                /* Ensure it fits within mobile screen */
                max-width: 300px;
                /* Limit width for better appearance */
                z-index: 1000;
                /* Ensure it appears above other elements */
                padding: 6px;
                /* Slightly increase padding for touch-friendliness */
                box-sizing: border-box;
            }

            .model-option {
                font-size: 12px;
                /* Slightly smaller font for mobile */
                padding: 8px 10px;
                /* Adjust padding for touch targets */
            }

            .sidebar {
                display: none;
            }

            .expanded-menu {
                display: block;
            }

            .mobile-sidebar {
                display: flex;
            }

            .hamburger-menu {
                display: block;
            }

            .main {
                margin-left: 0;
            }

            .main.shifted-left {
                margin-left: 0;
            }

            .user-dropdown {
                left: 0;
                width: 180px;
            }

            .input-container {
                max-width: 95%;
            }

            .chat-input {
                padding: 12px 80px 12px 12px;
            }

            .input-button,
            .send-button {
                width: 28px;
                height: 28px;
            }

            .input-button svg,
            .send-button svg {
                width: 16px;
                height: 16px;
            }

            .input-buttons-right {
                right: 8px;
                bottom: 8px;
                gap: 6px;
            }

            .example-card {
                width: 100%;
                max-width: 300px;
            }

            /* Disable hover effects for mobile */
            .mobile-new-chat-btn:hover,
            .mobile-sidebar .nav-link:hover,
            .mobile-sidebar .expanded-menu-item:hover,
            .tools-section li:hover {
                transform: none;
                background-color: inherit;
            }
        }

        @media (min-width: 769px) {
            .hamburger-menu {
                display: none;
            }

            .mobile-sidebar {
                display: none;
            }

            .mobile-sidebar-overlay {
                display: none;
            }
        }

        .expanded-menu-title-01 {
            text-align: center;

        }

        /* My actual Changes of mobile Devices  */
        @media (max-width: 768px) {
            .mobile-sidebar {
                z-index: 1100;
            }

            .mobile-sidebar-overlay {
                z-index: 1099;
            }

            .model-selector {
                position: fixed;
                top: 10px;
                left: 55%;
                transform: translateX(-50%);
                width: 80%;
                max-width: 250px;
                z-index: 1000;
                padding: 8px;
                box-sizing: border-box;
                display: flex;
                justify-content: center;
            }

            .model-option {
                font-size: 11px;
                padding: 6px 8px;
                flex: 1;
                text-align: center;
            }

            .chat-interface {
                z-index: 998;
            }
        }

        @media (max-width: 768px) {
            .input-area {
                position: fixed;
                bottom: 0;
                left: 0;
                right: 0;
                z-index: 1001;
                padding: 10px 0 20px;
                background: linear-gradient(to top, #ffffff 60%, rgba(255, 255, 255, 0));
            }

            .input-container {
                max-width: 95%;
                z-index: 1002;
            }

            .chat-area {
                padding: 80px 0 80px;
            }

            .model-selector {
                position: fixed;
                top: 10px;
                left: 50%;
                transform: translateX(-50%);
                width: 80%;
                max-width: 250px;
                z-index: 1000;
                padding: 8px;
                box-sizing: border-box;
                display: flex;
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .chat-input {
                overflow-y: hidden;
                /* Hide vertical scrollbar */
                -webkit-overflow-scrolling: touch;
                /* Enable smooth scrolling on iOS */
                scrollbar-width: none;
                /* Hide scrollbar for Firefox */
            }

            .chat-input::-webkit-scrollbar {
                display: none;
                /* Hide scrollbar for WebKit browsers (Chrome, Safari) */
            }
        }

        @media (max-width: 768px) {
            .input-area {
                position: fixed;
                /* Keep it fixed to stay above keyboard */
                bottom: 0;
                /* Align to bottom of viewport */
                left: 0;
                right: 0;
                z-index: 1001;
                padding: 10px 0 20px;
                /* Existing padding */
                transition: bottom 0.3s ease;
                /* Smooth transition when keyboard appears */
            }

            .input-container {
                max-width: 95%;
                z-index: 1002;
            }

            /* Ensure chat-area doesn't overlap input when keyboard is open */
            .chat-area {
                padding-bottom: 150px;
                /* Increase padding to account for input area and keyboard */
            }
        }

        @media (max-width: 768px) {

            /* Adjust input-buttons-right to remove gap */
            .input-buttons-right {
                right: 8px;
                bottom: 4px;
                /* Reduced to minimize gap */
                gap: 6px;
                display: flex;
                align-items: center;
                /* Ensure vertical alignment */
            }

            /* Increase size of submit button */
            .send-button {
                width: 36px;
                /* Increased from 28px */
                height: 30px;
                /* Increased from 28px */
                border-radius: 10px;
                /* Slightly larger for aesthetics */
            }

            .send-button svg {
                width: 20px;
                /* Increased from 16px */
                height: 20px;
                /* Increased from 16px */
            }

            /* Ensure microphone button matches submit button size */
            .input-button#mic-button {
                width: 36px;
                /* Increased from 28px */
                height: 36px;
                /* Increased from 28px */
                border-radius: 10px;
            }

            .input-button#mic-button svg {
                width: 20px;
                /* Increased from 16px */
                height: 20px;
                /* Increased from 16px */
            }

            /* Adjust input container padding to ensure buttons fit snugly */
            .input-container {
                padding: 6px;
                /* Reduced slightly to minimize vertical gap */
                align-items: center;
                /* Ensure vertical centering */
            }

            /* Ensure chat-input doesn't add extra spacing */
            .chat-input {
                padding: 10px 90px 10px 12px;
                /* Adjusted to align with buttons */
                line-height: 1.4;
                /* Prevent text misalignment */
            }
        }

        @media (max-width: 768px) {
            .hamburger-menu {
                background: none;
                /* Remove background */
                border: none;
                /* Remove border */
                box-shadow: none;
                /* Remove box shadow */
                border-radius: 0;
                /* Remove border radius */
                padding: 0;
                /* Remove padding to eliminate any box-like appearance */
                top: 12px;
                /* Keep positioning */
                left: 12px;
            }

            .hamburger-menu:hover {
                background: none;
                /* Remove hover background */
                transform: none;
                /* Remove scale transform on the button */
            }

            .hamburger-menu svg {
                width: 28px;
                /* Keep SVG size larger for mobile */
                height: 28px;
            }

            .hamburger-menu:hover svg {
                transform: scale(1.1);
                /* Scale the SVG on hover for feedback */
                stroke: var(--hover-color);
                /* Change stroke color to hover color (#43a047) */
            }

            .bot-message .avatar svg #logoDisplay,
            .typing-indicator-container .avatar svg #logoDisplay {
                display: none;
            }

            .bot-message .avatar,
            .typing-indicator-container .avatar {
                width: 0;
                margin: 0;
            }
        }

        @media (max-width: 768px) {
            .mobile-user-section {
                margin-top: auto;
                padding: 1rem;
                display: flex;
                flex-direction: column;
                align-items: center;
                border-top: 1px solid var(--border-color);
            }

            .mobile-user-section .user-account {
                width: 40px;
                height: 40px;
                border-radius: 50%;
                overflow: hidden;
                cursor: pointer;
                margin-bottom: 1rem;
            }

            .mobile-user-section .user-account img {
                width: 100%;
                height: 100%;
                object-fit: cover;

            }

            .mobile-user-section .user-dropdown {
                width: 100%;
                background-color: #f0f0f0;
                border-radius: 8px;
                display: flex;
                flex-direction: column;
            }

            .mobile-user-section .user-dropdown-item {
                padding: 10px;
                text-align: left;
                color: #333;
                text-decoration: none;
                font-size: 14px;
                border-bottom: 1px solid #e0e0e0;
            }

            .mobile-user-section .user-dropdown-item svg {
                margin-right: 8px;
            }
        }

        @media (max-width: 768px) {
            .mobile-sidebar {
                display: flex;
                flex-direction: column;
            }

            .chat-history-wrapper {
                flex: 1;
                overflow-y: auto;
                margin-bottom: 1rem;
                padding-right: 8px;
                /* optional: space for scrollbar */
            }

            .expanded-menu-list {
                padding: 0;
                margin: 0;
                list-style: none;
            }

            .user-account {
                flex-shrink: 0;
            }
        }

        @media (max-width: 768px) {
            .user-dropdown {
                position: absolute;
                bottom: 100px;
                /* Adjust this to control vertical position */
                left: 16px;
                /* Add some left padding from the screen edge */
                width: calc(100% - 32px);
                background-color: #ffffff;
                border-radius: 10px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                display: none;
                flex-direction: column;
                z-index: 1101;
                padding: 10px 0;
            }

            .user-dropdown.active {
                display: flex;
            }

            .user-dropdown-item {
                padding: 12px 20px;
                font-size: 14px;
                color: #333;
                border-bottom: 1px solid #e0e0e0;
            }

            .user-dropdown-item:last-child {
                border-bottom: none;
            }

            .user-account {
                position: relative;
                /* Necessary to position dropdown absolutely inside this */
                margin-bottom: 1rem;
                margin-left: 10px;
            }
        }

        @media (max-width: 768px) {
            .message-container {
                max-width: 90%;
                padding: 10px 15px;
            }

            .message-wrapper {
                max-width: 100%;
            }

            .message-content {
                width: 100%;
                max-width: 100%;
                padding: 12px;
            }
        }

        @media (max-width: 768px) {

            .bot-message .avatar,
            .typing-indicator-container .avatar {
                display: none;
                width: 0;
                height: 0;
                margin: 0;
                padding: 0;
            }

            .bot-message .message-wrapper,
            .typing-indicator-container .message-wrapper {
                align-items: flex-start;
                max-width: 100%;
            }

            .bot-message .message-content,
            .typing-indicator-container .message-content {
                padding: 12px;
                max-width: 100%;
                border-radius: 8px;
                margin-left: 0;
            }
        }

        @media (max-width: 768px) {

            /* Hide avatars for both bot and user messages, including typing indicator */
            .bot-message .avatar,
            .user-message .avatar,
            .typing-indicator-container .avatar {
                display: none;
                width: 0;
                height: 0;
                margin: 0;
                padding: 0;
            }

            /* Adjust message container to reduce side gaps */
            .message-container {
                max-width: 95%;
                /* Use most of the screen width */
                padding: 8px 10px;
                /* Minimal padding */
                margin-left: 5px;
                /* Small offset from left edge */
                margin-right: 5px;
                /* Small offset from right edge */
            }

            /* Align messages properly */
            .bot-message {
                justify-content: flex-start;
            }

            .user-message {
                justify-content: flex-end;
            }

            /* Ensure message wrapper takes full width */
            .message-wrapper {
                max-width: 100%;
                margin: 0;
            }

            .bot-message .message-wrapper {
                margin-left: 0;
                /* No left gap for bot messages */
            }

            .user-message .message-wrapper {
                margin-right: 0;
                /* No right gap for user messages */
            }

            /* Ensure message content fills wrapper */
            .message-content {
                width: 100%;
                max-width: 100%;
                padding: 10px;
                border-radius: 8px;
                margin: 0;
            }

            .bot-message .message-content,
            .typing-indicator-container .message-content {
                margin-left: 0;
                /* No left gap for bot messages */
            }

            .user-message .message-content {
                margin-right: 0;
                /* No right gap for user messages */
            }
        }

        @media (max-width: 768px) {

            /* Hide avatars for both bot and user messages, including typing indicator */
            .bot-message .avatar,
            .user-message .avatar,
            .typing-indicator-container .avatar {
                display: none;
                width: 0;
                height: 0;
                margin: 0;
                padding: 0;
            }

            /* Adjust message container to reduce side gaps */
            .message-container {
                max-width: 95%;
                /* Use most of the screen width */
                padding: 8px 10px;
                /* Minimal padding */
                margin-left: 5px;
                /* Small offset from left edge */
                margin-right: 5px;
                /* Small offset from right edge */
            }

            /* Align messages properly */
            .bot-message {
                justify-content: flex-start;
            }

            .user-message {
                justify-content: flex-end;
            }

            /* Ensure message wrapper takes appropriate width */
            .message-wrapper {
                max-width: 100%;
                margin: 0;
            }

            .bot-message .message-wrapper {
                margin-left: 0;
                /* No left gap for bot messages */
            }

            .user-message .message-wrapper {
                margin-right: 0;
                /* No right gap for user messages */
                max-width: 70%;
                /* Limit user message wrapper width */
            }

            /* Style message content */
            .message-content {
                width: 100%;
                max-width: 100%;
                padding: 10px;
                border-radius: 8px;
                margin: 0;
            }

            .bot-message .message-content,
            .typing-indicator-container .message-content {
                margin-left: 0;
                /* No left gap for bot messages */
                font-size: var(--base-font-size);
                /* 14px, full size for bot */
            }

            .user-message .message-content {
                margin-right: 0;
                /* No right gap for user messages */
                font-size: 12px;
                /* Smaller font for user messages */
                max-width: 300px;
                /* Fixed max width for compact user messages */
                padding: 8px;
                /* Slightly less padding for compactness */
            }
        }

        @media (min-width: 769px) {

            /* Desktop styles to maintain consistency */
            .message-container {
                max-width: 58rem;
                /* Default width for desktop */
                padding: 10px 20px;
                margin: 0 auto;
                padding-left: 70px;
            }

            .message-wrapper {
                max-width: 70%;
                /* Default wrapper width */
                margin: 0;
            }

            .bot-message .message-wrapper {
                margin-left: 0;
            }

            .user-message .message-wrapper {
                margin-right: 0;
                max-width: 60%;
                /* Slightly smaller wrapper for user messages */
            }

            .message-content {
                width: 100%;
                max-width: 100%;
                padding: 10px;
                border-radius: 8px;
                margin: 0;
                font-size: var(--base-font-size);
                /* 14px default */
            }

            .bot-message .message-content {
                margin-left: 0;
            }

            .user-message .message-content {
                margin-right: 0;
                font-size: 13px;
                /* Slightly smaller font for user messages */
                max-width: 400px;
                /* Fixed max width for compact user messages */
                padding: 8px;
                /* Slightly less padding */
            }
        }

        @media (max-width: 768px) {
            .mobile-sidebar-header {
                justify-content: flex-start;
                padding: 0.5rem 1.5rem;
            }

            .logo-container {
                display: flex;
                align-items: center;
                gap: 7px;
            }

            .logo {
                margin: 0;
                width: 32px;
                height: 32px;
            }

            .logo-text {
                font-size: 0.9rem;
                color: var(--text-color);
            }
        }

        @media (max-width: 768px) {
            .mobile-sidebar {
                padding: 0px;
            }

            .mobile-sidebar-header {
                padding-top: 15px;
                padding-left: 15px;
            }

            nav-menu .mobile-sidebar-header .logo-container .logo-text {
                font-size: 0.9rem;
            }

            .mobile-sidebar-header .logo-container .logo {
                width: 25px;
                height: 25px;
            }

            .mobile-sidebar .nav-menu {
                padding: 8px;
                padding-top: 3px;
            }

            .mobile-sidebar .nav-menu .nav-item .nav-link {
                padding-top: 5px;
            }

            .nav-link {
                display: flex;
                flex-direction: column;
                align-items: center;
                width: 100%;
                padding: 0.75rem 0;
                color: #2f2f2f;
                text-decoration: none;
                transition: all 0.2s;
                font-size: 5px;
            }

            .mobile-sidebar .nav-link {
                flex-direction: row;
                align-items: center;
                padding: 0.5rem;
                font-size: 0.9rem;
            }

            .expanded-menu-title-01 {
                text-align: left;
                padding-left: 14px;
                padding-bottom: 5px;
                font-size: 15px;
                color: #b0b0b0;
            }
        }


        /* Add to ChatUI.css */
        .speaker-button {
            background: none;
            border: none;
            cursor: pointer;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 10px;
            margin-top: 5px;
            transition: transform 0.2s;
        }

        .speaker-button svg {
            width: 16px;
            height: 16px;
            stroke: var(--primary-color);
        }

        .speaker-button:hover {
            transform: scale(1.1);
        }

        .speaker-button:hover svg {
            stroke: var(--hover-color);
        }

        @media (max-width: 768px) {
            .speaker-button {
                width: 18px;
                height: 18px;
                margin-left: 5px;
            }

            .speaker-button svg {
                width: 14px;
                height: 14px;
            }
        }



        .message-container.bot-message {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        .speaker-button {
            margin-top: 8px;
            background: none;
            border: none;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
        }

        .speaker-button svg {
            width: 18px;
            height: 18px;
            stroke: #4CAF50;
        }

        .speaker-button:hover svg {
            stroke: #45a049;
        }


        /* In ChatUI.css */
        .speaker-button {
            background: none;
            border: none;
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-left: 8px;
            margin-top: 8px;
            transition: transform 0.2s;
        }

        .speaker-button svg {
            width: 18px;
            height: 18px;
            stroke: var(--primary-color);
            fill: none;
        }

        .speaker-button:hover {
            transform: scale(1.1);
        }

        .speaker-button:hover svg {
            stroke: var(--hover-color);
        }

        .message-container.bot-message {
            display: flex;
            flex-direction: row;
            align-items: flex-start;
        }

        @media (max-width: 768px) {
            .speaker-button {
                width: 20px;
                height: 20px;
                margin-left: 5px;
                margin-top: 6px;
            }

            .speaker-button svg {
                width: 16px;
                height: 16px;
            }

            .message-container.bot-message {
                flex-direction: row;
                align-items: center;
            }
        }

        /* Speaker button styles */
        .speaker-button {
            background: none;
            border: none;
            cursor: pointer;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 1px auto 0;
            margin-left: 13px;
            /* Center horizontally, add top margin to position below */
            transition: transform 0.2s;
        }

        .speaker-button svg {
            width: 18px;
            height: 18px;
            stroke: var(--primary-color, #4CAF50);
            fill: none;
        }

        .speaker-button:hover {
            transform: scale(1.1);
        }

        .speaker-button:hover svg {
            stroke: var(--hover-color, #45a049);
        }

        /* Bot message container */
        .message-container.bot-message {
            display: flex;
            flex-direction: column;
            /* Stack message-wrapper and speaker button vertically */
            align-items: flex-start;
            /* Align content to the left */
            padding-bottom: 8px;
            /* Add padding to prevent overlap with next message */
        }

        /* Message wrapper */

        /* Error message styling */
        .error-message {
            background-color: #ffe6e6;
            color: #d32f2f;
            padding: 10px;
            border-radius: 5px;
            margin: 10px;
            text-align: center;
            font-size: 14px;
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            .speaker-button {
                width: 20px;
                height: 20px;
                margin-left: 10px;
                /* Adjust margin for mobile */
            }

            .speaker-button svg {
                width: 16px;
                height: 16px;
            }

            .message-container.bot-message {
                padding-bottom: 6px;
                /* Adjust padding for mobile */
            }
        }


        /* Image preview styles */
        .image-preview-container {
            position: relative;
            margin-bottom: 10px;
            max-width: 200px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .image-preview {
            max-width: 100%;
            max-height: 200px;
            display: block;
        }

        .remove-image-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background-color: rgba(255, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
        }

        .remove-image-btn:hover {
            background-color: rgba(255, 0, 0, 0.9);
        }

        /* User message with image */
        .user-message img {
            max-width: 100%;
            max-height: 300px;
            border-radius: 8px;
            margin-bottom: 5px;
        }

        @media (max-width: 768px) {
            .image-preview-container {
                max-width: 150px;
            }

            .user-message img {
                max-width: 150px;
                max-height: 150px;
            }
        }

        /* ChatUI.css */

        /* Image Preview in Input Area */
        .image-preview-container {
            position: relative;
            display: inline-block;
            margin: 8px 0;
        }

        .image-preview {
            max-width: 100px;
            max-height: 100px;
            border-radius: 8px;
            object-fit: cover;
        }

        .remove-image-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ff4d4f;
            color: white;
            border: none;
            border-radius: 50%;
            width: 20px;
            height: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 12px;
        }

        /* Message Container with Image */
        .message-container.user-message .message-content {
            display: flex;
            flex-direction: column;
        }

        .message-container.user-message .message-content img {
            max-width: 200px;
            max-height: 200px;
            border-radius: 8px;
            margin-bottom: 8px;
        }

        /* Ensure input area accommodates image preview */

        /* Microphone Overlay */
        .mic-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .mic-overlay.active {
            display: flex;
        }

        .mic-container {
            background: white;
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            max-width: 300px;
            width: 80%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            animation: fadeIn 0.3s ease-out;
        }

        .mic-icon {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            background: #4CAF50;
            margin: 0 auto 20px;
            display: flex;
            justify-content: center;
            align-items: center;
            transition: all 0.3s;
        }

        .mic-icon.listening {
            animation: pulse 1.5s infinite;
        }

        .mic-icon svg {
            width: 40px;
            height: 40px;
            stroke: white;
            stroke-width: 2;
        }

        .mic-status {
            font-size: 18px;
            margin-bottom: 20px;
            min-height: 24px;
        }

        .mic-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 16px;
            transition: background 0.3s;
        }

        .mic-button:hover {
            background: #3e8e41;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0.7);
            }

            70% {
                transform: scale(1.05);
                box-shadow: 0 0 0 15px rgba(76, 175, 80, 0);
            }

            100% {
                transform: scale(1);
                box-shadow: 0 0 0 0 rgba(76, 175, 80, 0);
            }
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Mobile styles */
        @media (max-width: 768px) {
            .mic-container {
                padding: 20px;
            }

            .mic-icon {
                width: 60px;
                height: 60px;
            }

            .mic-icon svg {
                width: 30px;
                height: 30px;
            }

            .mic-status {
                font-size: 16px;
            }
        }

        @media screen and (min-width: 768px) {
            .model-selector {
                width: 180px;
                /* Increased width for desktop */
                padding: 12px;
                /* Larger padding */
                font-size: 16px;
                /* Larger text */
                height: 43px;
                /* Optional: taller element */
            }

            .model-option {
                font-size: 12px;
                /* Slightly smaller font for mobile */
                padding: 3px 16px;
                /* Adjust padding for touch targets */
            }
        }

        /* Welcome Page */
        .welcome-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #4caf50, #81c784);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            animation: slideIn 1s ease-out forwards;
        }

        .welcome-content {
            text-align: center;
            color: #ffffff;
        }

        .welcome-message {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 1rem;
            display: inline-block;
        }

        .welcome-message span {
            display: inline-block;
            opacity: 0;
            /* Initial transform will be set via inline style by JavaScript */
            animation: letterJoin 0.6s ease-out forwards;
        }

        .welcome-subtext {
            font-size: 1.2rem;
            opacity: 0;
            animation: fadeIn 0.5s ease-out 2s forwards;
            /* Adjusted timing to match new animation */
        }

        /* Animations */
        @keyframes slideIn {
            from {
                transform: translateX(-100%);
            }

            to {
                transform: translateX(0);
            }
        }

        @keyframes slideOut {
            from {
                transform: translateX(0);
            }

            to {
                transform: translateX(100%);
            }
        }

        @keyframes letterJoin {
            to {
                opacity: 1;
                transform: translate(0, 0);
                /* Final position */
            }
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
            }
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .welcome-message {
                font-size: 1.8rem;
            }

            .welcome-subtext {
                font-size: 1rem;
            }
        }


        /* Noira default background when active */
        .model-option[data-model="noira"].active {
            background-color: #d6f5d6;
            /* soft green or choose your custom color */
            color: #2f2f2f;
            font-weight: bold;
        }

        #DreamCraftModel:hover {
            background-color: #4CAF50;
            color: #ffffff;
        }



        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--sidebar-color, #ffffff);
            border-radius: 12px;
            width: 90%;
            max-width: 400px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.2);
            overflow: hidden;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 20px;
            border-bottom: 1px solid var(--border-color, #ccc);
        }

        .modal-header h2 {
            font-size: 1.5rem;
            color: var(--text-color, #2f2f2f);
            margin: 0;
        }

        .close-button {
            background: none;
            border: none;
            font-size: 3rem;
            cursor: pointer;
            color: var(--text-color, #2f2f2f);
        }

        .close-button:hover {
            color: var(--hover-color, #43a047);
        }

        .modal-body {
            padding: 20px;
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .preference-section {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .preference-section label {
            font-size: var(--base-font-size, 14px);
            color: var(--text-color, #2f2f2f);
            font-weight: 500;
        }

        .preference-section select,
        .preference-section input[type="range"] {
            padding: 8px;
            border: 1px solid var(--border-color, #ccc);
            border-radius: 8px;
            font-size: var(--base-font-size, 14px);
            background: var(--secondary-color, #f9f9f9);
        }

        .preference-section select:focus,
        .preference-section input[type="range"]:focus {
            outline: none;
            border-color: var(--primary-color, #4caf50);
            box-shadow: 0 0 5px var(--input-glow, rgba(76, 175, 80, 0.3));
        }

        #font-size-value {
            font-size: var(--base-font-size, 14px);
            color: #666;
        }

        .modal-footer {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            padding: 15px 20px;
            border-top: 1px solid var(--border-color, #ccc);
        }

        .modal-button {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: var(--base-font-size, 14px);
            transition: background-color 0.2s;
        }

        #save-preferences {
            background: var(--primary-color, #4caf50);
            color: #ffffff;
        }

        #save-preferences:hover {
            background: var(--hover-color, #43a047);
        }

        #cancel-preferences {
            background: #f0f0f0;
            color: var(--text-color, #2f2f2f);
        }

        #cancel-preferences:hover {
            background: #e0e0e0;
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .modal-content {
                width: 95%;
                max-width: 350px;
            }

            .modal-header h2 {
                font-size: 1.3rem;
            }

            .modal-body {
                padding: 15px;
            }

            .preference-section select,
            .preference-section input[type="range"] {
                padding: 6px;
            }

            .modal-button {
                padding: 8px 16px;
                font-size: 13px;
            }
        }

        .icon-wrapper {
            width: 24px;
            height: 24px;
            margin-right: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .animated-icon {
            width: 100%;
            height: 100%;
            animation: pulseIcon 2s infinite ease-in-out;
        }

        @keyframes pulseIcon {

            0%,
            100% {
                transform: scale(1);
                opacity: 0.8;
            }

            50% {
                transform: scale(1.2);
                opacity: 1;
            }
        }

        /* Preference Section Layout */
        .preference-section {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .preference-section input[type="text"],
        .preference-section select {
            flex: 1;
            padding: 8px;
            border: 1px solid var(--border-color, #ccc);
            border-radius: 8px;
            font-size: var(--base-font-size, 14px);
            background: var(--secondary-color, #f9f9f9);
        }

        .preference-section input[type="text"]:focus,
        .preference-section select:focus {
            outline: none;
            border-color: var(--primary-color, #4caf50);
            box-shadow: 0 0 5px var(--input-glow, rgba(76, 175, 80, 0.3));
        }

        /* Specific Icon Animations */
        .preference-section:nth-child(1) .animated-icon {
            animation: bounceIcon 1.5s infinite ease-in-out;
        }

        .preference-section:nth-child(2) .animated-icon {
            animation: rotateIcon 3s infinite linear;
        }

        .preference-section:nth-child(3) .animated-icon {
            animation: sparkleIcon 2s infinite ease-in-out;
        }

        .preference-section:nth-child(4) .animated-icon {
            animation: spinIcon 2s infinite linear;
        }

        .preference-section:nth-child(5) .animated-icon {
            animation: pulseIcon 2s infinite ease-in-out;
        }

        @keyframes bounceIcon {

            0%,
            100% {
                transform: translateY(0);
            }

            50% {
                transform: translateY(-5px);
            }
        }

        @keyframes rotateIcon {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        @keyframes sparkleIcon {

            0%,
            100% {
                opacity: 0.6;
                transform: scale(1);
            }

            50% {
                opacity: 1;
                transform: scale(1.3);
            }
        }

        @keyframes spinIcon {
            0% {
                transform: rotate(0deg);
            }

            100% {
                transform: rotate(360deg);
            }
        }

        /* Mobile Responsive Styles */
        @media (max-width: 768px) {
            .preference-section {
                flex-direction: column;
                align-items: flex-start;
            }

            .icon-wrapper {
                margin-bottom: 5px;
            }

            .preference-section input[type="text"],
            .preference-section select {
                width: 100%;
                padding: 6px;
            }
        }

        .message-container {
            padding: 12px 24px;
            background: #f8fafc;
        }

        .message {
            margin: 0;
            font-size: 0.95rem;
            font-weight: 500;
            text-align: center;
        }

        .message.success {
            color: #4caf50;
        }

        .message.error {
            color: #e53935;
        }

        .profile-picture {
            margin-bottom: 25px;
            position: relative;
            width: 150px;
            height: 150px;
            margin-left: auto;
            margin-right: auto;
        }



        /* Modal Content Adjustments */
        .modal-content {
            width: 90%;
            max-width: 500px;
            /* Increased width */
            max-height: 90vh;
            /* Limit height for scrolling */
            overflow-y: auto;
            /* Make it scrollable */
        }

        /* Profile Picture Selection */
        .profile-picture-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 10px;
        }

        .profile-picture-option {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: border-color 0.2s, transform 0.2s;
        }

        .profile-picture-option:hover {
            border-color: var(--primary-color);
            transform: scale(1.1);
        }

        .profile-picture-option.active {
            border-color: var(--primary-color);
        }

        .selected-profile-picture {
            margin-top: 15px;
            text-align: center;
        }

        .selected-profile-picture img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            border: 2px solid var(--primary-color);
            object-fit: cover;
        }

        /* Gender Buttons */
        .gender-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .gender-button {
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 8px 16px;
            font-size: var(--base-font-size);
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .gender-button:hover {
            background-color: var(--button-hover-bg);
            border-color: var(--primary-color);
        }

        .gender-button.active {
            background-color: var(--primary-color);
            color: #ffffff;
            border-color: var(--primary-color);
        }

        /* Assistant Buttons */
        .assistant-options {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .assistant-button {
            display: flex;
            align-items: center;
            gap: 10px;
            background-color: var(--secondary-color);
            border: 1px solid var(--border-color);
            border-radius: 12px;
            padding: 10px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
        }

        .assistant-button img {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
        }

        .assistant-button span {
            font-size: var(--base-font-size);
            color: var(--text-color);
        }

        .assistant-button:hover {
            background-color: var(--button-hover-bg);
            border-color: var(--primary-color);
        }

        .assistant-button.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .assistant-button.active span {
            color: #ffffff;
        }

        /* Input Field Styling */
        .preference-section input[type="text"] {
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 10px 15px;
            font-size: var(--base-font-size);
            transition: border-color 0.2s, box-shadow 0.2s;
        }

        .preference-section input[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 5px var(--input-glow);
        }

        /* Select Dropdown Styling */
        .preference-section select {
            border-radius: 20px;
            padding: 10px 15px;
        }

        /* Modal Footer Adjustment */
        .modal-footer {
            justify-content: center;
            /* Center the single button */
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .modal-content {
                max-width: 90%;
            }

            .profile-picture-option {
                width: 50px;
                height: 50px;
            }

            .selected-profile-picture img {
                width: 60px;
                height: 60px;
            }

            .gender-button {
                padding: 6px 12px;
                font-size: 13px;
            }

            .assistant-button {
                padding: 8px;
            }

            .assistant-button img {
                width: 35px;
                height: 35px;
            }

            .assistant-button span {
                font-size: 13px;
            }
        }


        /* Modal Content Adjustments */
        .modal-content {
            width: 90%;
            max-width: 800px;
            /* Increased width from 500px to 600px */
            max-height: 90vh;
            overflow-y: auto;
            /* Hide scrollbar for WebKit browsers (Chrome, Safari) */
            scrollbar-width: none;
            /* Firefox */
            -ms-overflow-style: none;
            /* IE and Edge */
        }

        .modal-content::-webkit-scrollbar {
            display: none;
            /* Hide scrollbar for WebKit browsers */
        }

        /* Modal Content Adjustments */
        .modal-content {
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            scrollbar-width: none;
            -ms-overflow-style: none;
        }

        .modal-content::-webkit-scrollbar {
            display: none;
        }

        /* Modal Animation for Closing */
        .modal {
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .modal.active {
            display: flex;
            opacity: 1;
        }

        /* Increase Overall Font Size and Spacing in Modal */
        .modal-content * {
            font-size: calc(var(--base-font-size) * 1.2);
        }

        .modal-header h2 {
            font-size: calc(var(--base-font-size) * 1.5);
        }

        .preference-section {
            margin-bottom: 25px;
        }

        .preference-section label {
            font-size: calc(var(--base-font-size) * 1.3);
            margin-bottom: 10px;
        }

        /* Input Field Styling (Name Input) */
        .preference-section input[type="text"] {
            width: 100%;
            padding: 15px 18px;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: calc(var(--base-font-size) * 1.2);
            background: #f9f9f9;
            transition: border-color 0.3s ease, box-shadow 0.3s ease;
            box-sizing: border-box;
        }

        .preference-section input[type="text"]:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.2);
            outline: none;
        }

        /* Gender Options (Side by Side, Image Above Text) */
        .gender-options {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            gap: 15px;
            width: 100%;
        }

        .gender-button {
            flex: 1;
            padding: 18px;
            background-color: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: calc(var(--base-font-size) * 1.2);
            color: var(--text-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        }

        .gender-button:hover {
            background-color: #e6f4ea;
            border-color: var(--primary-color);
        }

        .gender-button.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: #ffffff;
            font-weight: 600;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
            /* Added subtle shadow for active state */
        }

        /* .gender-button.active .gender-icon {
            filter: brightness(0) invert(1);
        } */

        .gender-icon {
            width: 70px;
            height: 70px;
            object-fit: contain;
            transition: filter 0.3s ease;
        }

        /* Assistant Options (Side by Side, Image Above Text) */
        .assistant-options {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            gap: 15px;
            width: 100%;
        }

        .assistant-button {
            flex: 1;
            padding: 18px;
            background-color: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease, box-shadow 0.3s ease;
        }

        .assistant-icon,
        .gender-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
        }

        .assistant-icon {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            object-fit: cover;
        }

        .assistant-button span {
            font-size: calc(var(--base-font-size) * 1.2);
            color: var(--text-color);
        }

        .assistant-button:hover {
            background-color: #e6f4ea;
            border-color: var(--primary-color);
        }

        .assistant-button.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
            /* Added subtle shadow for active state */
        }

        .assistant-button.active span {
            color: #ffffff;
            font-weight: 600;
            /* Added for consistency with other sections */
        }

        /* Language Options (Side by Side) */
        .language-options {
            display: flex;
            flex-direction: row;
            justify-content: space-between;
            gap: 15px;
            width: 100%;
        }

        .language-button {
            flex: 1;
            padding: 15px;
            background-color: #f0f0f0;
            border: 2px solid #e0e0e0;
            border-radius: 12px;
            font-size: calc(var(--base-font-size) * 1.2);
            color: var(--text-color);
            text-align: center;
            cursor: pointer;
            transition: background-color 0.3s ease, border-color 0.3s ease, color 0.3s ease, box-shadow 0.3s ease;
        }

        .language-button:hover {
            background-color: #e6f4ea;
            border-color: var(--primary-color);
        }

        .language-button.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: #ffffff;
            font-weight: 600;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
            /* Added subtle shadow for active state */
        }

        /* Modal Footer Button */
        .modal-button {
            padding: 12px 25px;
            font-size: calc(var(--base-font-size) * 1.2);
        }

        /* Responsive Adjustments */
        @media (max-width: 768px) {
            .modal-content {
                max-width: 95%;
            }

            .modal-content * {
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .modal-header h2 {
                font-size: calc(var(--base-font-size) * 1.3);
            }

            .preference-section label {
                font-size: calc(var(--base-font-size) * 1.2);
            }

            .preference-section input[type="text"] {
                padding: 12px 15px;
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .gender-button {
                padding: 14px;
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .gender-icon {
                width: 42px;
                height: 42px;
            }

            .assistant-button {
                padding: 14px;
            }

            .assistant-icon,
            .gender-icon {
                width: 54px;
                height: 54px;
            }

            .assistant-button span {
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .language-button {
                padding: 12px;
                font-size: calc(var(--base-font-size) * 1.1);
            }

            .modal-button {
                padding: 10px 20px;
                font-size: calc(var(--base-font-size) * 1.1);
            }
        }


        .selected-button {
            background-color: #d1e7dd !important;
            /* light green, or choose any */
            border: 2px solid #4CAF50;
            border-radius: 8px;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        #close-button {
            background-color: red;
        }

        .message-container {
            margin-left: 160px;
        }


        /* SoulSafe Page */
        .soulsafe-page {
            background: linear-gradient(135deg, #fce4ec 0%, #f8bbd0 100%);
            padding: 30px;
            border-radius: 15px;
            min-height: 100%;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .soulsafe-page h2 {
            color: #880e4f;
            font-family: 'Poppins', sans-serif;
            text-align: center;
            margin-bottom: 10px;
        }

        .soulsafe-page p {
            color: #ad1457;
            text-align: center;
            font-style: italic;
            margin-bottom: 40px;
        }

        /* Horizontal Scrollable Container for Moments */
        .moments-container {
            display: flex;
            overflow-x: auto;
            gap: 20px;
            padding: 10px;
            scrollbar-width: thin;
            scrollbar-color: #ad1457 #f5f5f5;
            width: 100%;
            justify-content: flex-start;
        }

        /* Flip Card for Each Moment */
        .moment-card {
            min-width: 200px;
            height: 300px;
            perspective: 1000px;
        }

        .moment-card-inner {
            position: relative;
            width: 100%;
            height: 100%;
            transition: transform 0.8s;
            transform-style: preserve-3d;
        }

        .moment-card:hover {
            cursor: pointer;
        }

        /* Front Face of the Card */
        .moment-card-front {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(145deg, #f06292, #d81b60);
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            backface-visibility: hidden;
        }

        .moment-card-front svg {
            width: 40px;
            height: 40px;
            margin-bottom: 10px;
        }

        .moment-card-front h4 {
            color: #fff;
            font-family: 'Poppins', sans-serif;
            margin: 0;
            font-size: 14px;
            text-align: center;
        }

        .moment-card-front small {
            color: #fff;
            font-size: 12px;
            opacity: 0.8;
        }

        /* Back Face of the Card */
        .moment-card-back {
            position: absolute;
            width: 100%;
            height: 100%;
            background: #fff;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            backface-visibility: hidden;
            transform: rotateY(180deg);
            overflow-y: auto;
            padding: 15px;
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .moment-card-back h4 {
            color: #d81b60;
            font-family: 'Poppins', sans-serif;
            margin: 0 0 10px;
            font-size: 14px;
            text-align: center;
        }

        .moment-card-back small {
            color: #757575;
            font-size: 12px;
            margin-bottom: 10px;
        }

        .moment-card-back img {
            max-width: 100%;
            max-height: 120px;
            border-radius: 5px;
        }

        .moment-card-back p {
            margin: 0;
            font-size: 12px;
            color: #424242;
            text-align: center;
            max-height: 80px;
            overflow-y: auto;
        }

        .moment-card-back audio {
            width: 100%;
            margin-top: 10px;
        }

        /* No Moments Message */
        .no-moments {
            color: #757575;
            text-align: center;
            width: 100%;
        }
    </style>
</head>

<body>
 <a href="/login" class="login-btn">Login</a>

    <!-- Hamburger Menu -->
    <button class="hamburger-menu" id="hamburger-menu" aria-label="Open Menu">
        <svg viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="2.5" stroke-linecap="round"
            stroke-linejoin="round">
            <path d="M4 8h16" />
            <path d="M4 16h16" />
        </svg>
    </button>

    <!-- Mobile Sidebar Overlay -->
    <div class="mobile-sidebar-overlay" id="mobile-sidebar-overlay"></div>

    <!-- Mobile Sidebar (Drawer) -->
    <aside class="mobile-sidebar" id="mobile-sidebar" aria-label="Mobile Navigation">
        <div class="mobile-sidebar-header">
            <div class="logo-container">
                <div class="logo" aria-label="App Logo">
                    <svg width="32" height="32" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="1.5"
                        stroke-linecap="round" stroke-linejoin="round">
                        <path d="M12 2L14 10L22 12L14 14L12 22L10 14L2 12L10 10L12 2Z" fill="#4CAF50"
                            stroke="#4CAF50" />
                        <path d="M5 3L5.5 5L7 5.5L5.5 6L5 8L4.5 6L3 5.5L4.5 5L5 3Z" fill="#81C784" stroke="#4CAF50" />
                        <path d="M17 16L17.3 17.5L18.5 18L17.3 18.5L17 20L16.7 18.5L15.5 18L16.7 17.5L17 16Z"
                            fill="#81C784" stroke="#4CAF50" />
                    </svg>
                </div>
                <span class="logo-text">DreamWeaver</span>
            </div>
        </div>


        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="home" aria-label="Home">
                        <div class="nav-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8" />
                                <path d="M21 21l-4.35-4.35" />
                            </svg>
                        </div>
                        Home
                    </a>
                </li>
                <li class="nav-item">
                    <a href="DreamCraft.html" class="nav-link">
                        <div class="nav-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L14 10L22 12L14 14L12 22L10 14L2 12L10 10L12 2Z" />
                            </svg>
                        </div>
                        DreamCraft
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="soul-safe" aria-label="SoulSafe">
                        <div class="nav-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 8a7 7 0 0 1 14 0v4a4 4 0 0 1-4 4H9a4 4 0 0 1-4-4V8z" />
                                <path d="M12 16v2m-2-2v2m4-2v2" />
                            </svg>
                        </div>
                        SoulSafe
                    </a>
                </li>
            </ul>
        </nav>
        <button class="mobile-new-chat-btn" id="mobile-new-chat-btn" aria-label="New Chat">New Chat</button>

        <div class="chat-history-wrapper">
            <div class="expanded-menu-title-01">
                <span>Chat History</span>
            </div>
            <ul class="expanded-menu-list" id="mobile-chat-history-list">
                <!-- Chat history items -->
            </ul>
        </div>

        <div class="user-account" id="user-account">
            <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=40&h=40&q=80"
                alt="User Profile">

        </div>

        <!-- User Dropdown -->
        <div class="user-dropdown" id="user-dropdown">
            <a href="#" class="user-dropdown-item" data-tooltip="My account">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                </svg>
                My account
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Personalize">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 19l-2-2 2-2m0 0H7v-5m5 7l2-2m-2-2l2 2m0-4l2 2 2-2m0 0V7h5m-7 7l-2 2" />
                </svg>
                Personalize
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Notifications">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                    <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                </svg>
                Notifications
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Appearance">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 3h18v18H3z" />
                    <path d="M21 9H3" />
                </svg>
                Appearance
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Purchases">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
                    <path d="M3 6h18" />
                    <path d="M16 10a4 4 0 0 1-8 0" />
                </svg>
                Purchases
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3" />
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                </svg>
                Settings
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Voice Support">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 19l-2-2 2-2m0 0H7v-5m5 7l2-2m-2-2l2 2m0-4l2 2 2-2m0 0V7h5m-7 7l-2 2" />
                </svg>
                Voice Support
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Language">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10" />
                    <line x1="2" y1="12" x2="22" y2="12" />
                    <path
                        d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                </svg>
                Language
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Incognito">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
                Incognito
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Logout">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" />
                </svg>
                Logout
            </a>
        </div>

    </aside>

    <!-- Left Sidebar (Desktop) -->
    <aside class="sidebar" id="sidebar" aria-label="Navigation">
        <div class="logo" aria-label="App Logo">
            <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="1.5"
                stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2L14 10L22 12L14 14L12 22L10 14L2 12L10 10L12 2Z" fill="#4CAF50" stroke="#4CAF50" />
                <path d="M5 3L5.5 5L7 5.5L5.5 6L5 8L4.5 6L3 5.5L4.5 5L5 3Z" fill="#81C784" stroke="#4CAF50" />
                <path d="M17 16L17.3 17.5L18.5 18L17.3 18.5L17 20L16.7 18.5L15.5 18L16.7 17.5L17 16Z" fill="#81C784"
                    stroke="#4CAF50" />
            </svg>
        </div>

        <button class="add-btn" id="add-btn" aria-label="Add new chat">
            <svg viewBox="0 0 24 24" width="18" height="18" stroke="#ffffff" stroke-width="2" fill="none">
                <path d="M12 5v14M5 12h14" />
            </svg>
        </button>

        <nav>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="#" class="nav-link active" data-section="home" aria-label="Home">
                        <div class="nav-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <circle cx="11" cy="11" r="8" />
                                <path d="M21 21l-4.35-4.35" />
                            </svg>
                        </div>
                        Home
                    </a>
                </li>
                
                <li class="nav-item">
                    <a href="#" class="nav-link" data-section="soul-safe" aria-label="SoulSafe">
                        <div class="nav-icon">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M5 8a7 7 0 0 1 14 0v4a4 4 0 0 1-4 4H9a4 4 0 0 1-4-4V8z" />
                                <path d="M12 16v2m-2-2v2m4-2v2" />
                            </svg>
                        </div>
                        SoulSafe
                    </a>
                </li>
            </ul>
        </nav>

        <!-- User Account -->
        <div class="user-account" id="user-account-01">
            <img src="https://images.unsplash.com/photo-1535713875002-d1d0cf377fde?ixlib=rb-4.0.3&auto=format&fit=crop&w=40&h=40&q=80"
                alt="User Profile">
        </div>

        <!-- User Dropdown -->
        <div class="user-dropdown" id="user-dropdown-01">
            <a href="#" class="user-dropdown-item" data-tooltip="My account">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2" />
                    <circle cx="12" cy="7" r="4" />
                </svg>
                My account
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Personalize">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 19l-2-2 2-2m0 0H7v-5m5 7l2-2m-2-2l2 2m0-4l2 2 2-2m0 0V7h5m-7 7l-2 2" />
                </svg>
                Personalize
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Notifications">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9" />
                    <path d="M13.73 21a2 2 0 0 1-3.46 0" />
                </svg>
                Notifications
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Appearance">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 3h18v18H3z" />
                    <path d="M21 9H3" />
                </svg>
                Appearance
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Purchases">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M6 2L3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4z" />
                    <path d="M3 6h18" />
                    <path d="M16 10a4 4 0 0 1-8 0" />
                </svg>
                Purchases
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Settings">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="3" />
                    <path
                        d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l-.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
                </svg>
                Settings
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Voice Support">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 19l-2-2 2-2m0 0H7v-5m5 7l2-2m-2-2l2 2m0-4l2 2 2-2m0 0V7h5m-7 7l-2 2" />
                </svg>
                Voice Support
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Language">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="12" r="10" />
                    <line x1="2" y1="12" x2="22" y2="12" />
                    <path
                        d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z" />
                </svg>
                Language
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Incognito">
                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2" />
                    <circle cx="9" cy="7" r="4" />
                    <path d="M23 21v-2a4 4 0 0 0-3-3.87" />
                    <path d="M16 3.13a4 4 0 0 1 0 7.75" />
                </svg>
                Incognito
            </a>
            <a href="#" class="user-dropdown-item" data-tooltip="Logout" style="width:200px">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="width: 20px;">
                    <path d="M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9" />
                </svg>
                Logout
            </a>
        </div>
    </aside>
    <div class="expanded-menu" id="expanded-menu">
        <div class="expanded-menu-title">
            <span>Chat History</span>
            <button id="toggle-pin" class="pin-icon" title="Pin Sidebar">
                <svg id="pin-svg" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24"
                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M16 3v4a1 1 0 0 0 1 1h4" />
                    <path d="M8 16l-4 4" />
                    <path d="M3 21l4-4 10-10a2.828 2.828 0 0 1 4 4L7 21H3z" />
                </svg>
            </button>
        </div>

        <ul class="expanded-menu-list" id="chat-history-list">
            <!-- Chat history items will be dynamically added here -->
        </ul>
    </div>

    <!-- Main Content -->
    <div class="main">
        <div class="page-content" id="page-content">
            <div class="welcome-page" id="welcome-page">
                <div class="welcome-content">
                    <h1 class="welcome-message">Welcome to Wellnesshub AI</h1>
                    <p class="welcome-subtext">"WellnessHub: Your partner in health and emotional care."!</p>
                </div>
            </div>
            <!-- Chat Interface -->
            <div class="chat-interface" id="chat-interface">
                


                <!-- Chat Area -->
                <div class="chat-area" id="chat-area">
                    <!-- Welcome screen shown by default -->
                    <div class="welcome-screen" id="welcome-screen">
                        <h1 class="welcome-title">How can I help you today?</h1>
                        <div class="examples-container">
<div class="example-card">
    <div class="example-title">ðŸ¤’ Check symptoms for fever and sore throat</div>
    <div class="example-text">Ask WellnessHub about possible causes, home care tips, and when to see a doctor.</div>
</div>
<div class="example-card">
    <div class="example-title">ðŸ©¹ Get quick first-aid help</div>
    <div class="example-text">Learn step-by-step what to do for a minor burn, cut, or injury.</div>
</div>
<div class="example-card">
    <div class="example-title">ðŸ’š Boost emotional wellness</div>
    <div class="example-text">Receive calming affirmations and stress-relief exercises when feeling anxious.</div>
</div>
<div class="example-card">
    <div class="example-title">ðŸ˜´ Sleep and relaxation tips</div>
    <div class="example-text">Ask for bedtime routines, guided breathing, or music suggestions for better sleep.</div>
</div>

                        </div>
                    </div>
                </div>

                <!-- Input Area -->
                <div class="input-area">
                    <div class="input-container">
                        <div class="input-buttons-left">
                            <!-- File Upload Button -->
                            <button class="input-button" id="file-upload-button" title="Upload File">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                                    <polyline points="14 2 14 8 20 8" />
                                    <path d="M16 13H8" />
                                    <path d="M16 17H8" />
                                    <path d="M10 9H8" />
                                </svg>
                            </button>
                            <!-- Voice Assistant Button -->
                            <button class="input-button" id="voice-assistant-button" title="Voice Input">
                                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"
                                    fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                    stroke-linejoin="round">
                                    <path d="M12 19l-2-2 2-2m0 0H7v-5m5 7l2-2m-2-2l2 2m0-4l2 2 2-2m0 0V7h5m-7 7l-2 2" />
                                </svg>
                            </button>
                        </div>
                        <textarea class="chat-input" id="chat-input" placeholder="Message WellnessHub Assistant..."
                            rows="1"></textarea>
                        <div class="input-buttons-right">
                            <button class="input-button" id="mic-button" title="Microphone">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                                    stroke-linecap="round" stroke-linejoin="round">
                                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z" />
                                    <path d="M19 10v2a7 7 0 0 1-14 0v-2" />
                                    <line x1="12" y1="19" x2="12" y2="23" />
                                    <line x1="8" y1="23" x2="16" y2="23" />
                                </svg>
                            </button>

                            <button class="send-button" id="send-button">
                                <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M22 2L11 13" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                                        stroke-linejoin="round" />
                                    <path d="M22 2L15 22L11 13L2 9L22 2Z" stroke="currentColor" stroke-width="2"
                                        stroke-linecap="round" stroke-linejoin="round" />
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="js/ChatUI.js">

    </script>

    <!-- Microphone Overlay -->
    <!-- Microphone Overlay -->
    <div class="mic-overlay" id="mic-overlay">
        <div class="mic-container">
            <div class="mic-icon" id="mic-icon">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                    stroke-linejoin="round">
                    <path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"></path>
                    <path d="M19 10v2a7 7 0 0 1-14 0v-2"></path>
                    <line x1="12" y1="19" x2="12" y2="23"></line>
                    <line x1="8" y1="23" x2="16" y2="23"></line>
                </svg>
            </div>
            <div class="mic-status" id="mic-status">Tap microphone to start</div>
            <button class="mic-button" id="mic-stop-button">Stop Listening</button>
        </div>
    </div>



    <div class="modal" id="personalize-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Your Profile</h2>
                <button class="close-button" id="close-modal" style="font-size:30px;">Ã—</button>
            </div>
            <div class="modal-body">
                <div class="preference-section">
                    <label for="profile-picture-options">Choose Profile Picture</label>
                    <div class="selected-profile-picture">
                        <img id="profile-picture-preview" src="\static\image\G-1.jpg" alt="Profile Picture">
                    </div>
                    <div class="profile-picture-options" id="profile-picture-options">
                       
                    </div>
                </div>
                <div class="preference-section">
                    <label for="user-name">What's your nickname?</label>
                    <input type="text" id="user-name" placeholder="Your Name">
                </div>
                <div class="preference-section">
                    <label>Select Gender</label>
                    <div class="gender-options" id="gender-buttons">
                        <button class="gender-button select-button" data-value="male">
                            <img src="\static\image\male .png" alt="Male Icon" class="gender-icon">
                            <span>Male</span>
                        </button>
                        <button class="gender-button select-button" data-value="female">
                            <img src="\static\image\female.png" alt="Female Icon" class="gender-icon">
                            <span>Female</span>
                        </button>
                    </div>
                </div>
                <div class="preference-section">
                    <label for="assistant-buttons">Select Assistant Type</label>
                    <div class="assistant-options" id="assistant-buttons">
                        <button class="assistant-button select-button" data-value="female">
                            <img src="\static\image\image.webp" alt="Female Assistant" class="assistant-icon">
                            <span>Female Assistant</span>
                        </button>
                        <button class="assistant-button select-button" data-value="male">
                            <img src="\static\image\Male image.jpg" alt="Male Assistant" class="assistant-icon">
                            <span>Male Assistant</span>
                        </button>
                    </div>
                </div>
                <div class="preference-section">
                    <label for="language-buttons">Select Language</label>
                    <div class="language-options" id="language-buttons">
                        <button class="language-button  select-button" data-value="en">English</button>
                        <button class="language-button  select-button" data-value="hi">Hindi</button>
                        <button class="language-button  select-button" data-value="mr">Marathi</button>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="modal-button" id="save-preferences">Save Profile</button>
            </div>
            <div class="message success" id="success-message">Profile saved successfully!</div>
            <div class="message error" id="error-message">Please fill all required fields.</div>
        </div>
    </div>
</body>
<script>

    document.addEventListener('DOMContentLoaded', () => {
    // DOM elements
    const sidebar = document.getElementById('sidebar');
    const userAccount = document.getElementById('user-account');
    const userDropdown = document.getElementById('user-dropdown');
    const chatArea = document.getElementById('chat-area');
    const chatInput = document.getElementById('chat-input');
    const sendButton = document.getElementById('send-button');
    const welcomeScreen = document.getElementById('welcome-screen');
    const modelOptions = document.querySelectorAll('.model-option');
    const addBtn = document.getElementById('add-btn');
    const chatHistoryList = document.getElementById('chat-history-list');
    const exampleCards = document.querySelectorAll('.example-card');
    const expandedMenu = document.getElementById('expanded-menu');
    const pageContent = document.getElementById('page-content');
    const chatInterface = document.getElementById('chat-interface');
    const navLinks = document.querySelectorAll('.nav-link');
    const togglePinBtn = document.getElementById('toggle-pin');
    const fileUploadButton = document.getElementById('file-upload-button');
    const voiceAssistantButton = document.getElementById('voice-assistant-button');
    const micButton = document.getElementById('mic-button');
    const hamburgerMenu = document.getElementById('hamburger-menu');
    const mobileSidebar = document.getElementById('mobile-sidebar');
    const mobileNewChatBtn = document.getElementById('mobile-new-chat-btn');
    const mobileChatHistoryList = document.getElementById('mobile-chat-history-list');
    const mobileSidebarOverlay = document.getElementById('mobile-sidebar-overlay');

    const welcomePage = document.getElementById('welcome-page');
    const welcomeMessage = document.querySelector('.welcome-message');


    const personalizeModal = document.getElementById('personalize-modal');
    const closeModalButton = document.getElementById('close-modal');
    const savePreferencesButton = document.getElementById('save-preferences');
    const cancelPreferencesButton = document.getElementById('cancel-preferences');
    const userNameInput = document.getElementById('user-name');
    const genderButtons = document.querySelectorAll('#gender-buttons .select-button');
    const assistantButtons = document.querySelectorAll('#assistant-buttons .select-button');
    const languageButtons = document.querySelectorAll('#language-buttons .select-button');
    const successMessage = document.getElementById('success-message');
    const errorMessage = document.getElementById('error-message');


    document.querySelectorAll('.user-dropdown-item').forEach(item => {
        if (item.textContent.includes('Personalize')) {
            item.addEventListener('click', (e) => {
                e.preventDefault();
                personalizeModal.classList.add('active');
                userDropdownMobile.classList.remove('active');
                userDropdownDesktop.classList.remove('active');
                successMessage.style.display = 'none';
                errorMessage.style.display = 'none';
            });
        }
    });

    function showWelcomePage() {
        // Split the welcome message into individual letters
        const text = welcomeMessage.textContent;
        welcomeMessage.textContent = '';
        const directions = [
            { x: 0, y: -50 }, // Top
            { x: 0, y: 50 }, // Bottom
            { x: -50, y: 0 }, // Left
            { x: 50, y: 0 } // Right
        ];

        text.split('').forEach((char, index) => {
            const span = document.createElement('span');
            span.textContent = char === ' ' ? '\u00A0' : char; // Preserve spaces
            // Randomly select a direction
            const direction = directions[Math.floor(Math.random() * directions.length)];
            // Set initial position using inline style
            span.style.transform = `translate(${direction.x}px, ${direction.y}px)`;
            span.style.animationDelay = `${index * 0.08}s`; // Increased stagger for effect
            welcomeMessage.appendChild(span);
        });

        // Hide chat interface initially
        chatInterface.style.display = 'none';

        // After animation, slide out welcome page and show chat interface
        setTimeout(() => {
            welcomePage.style.animation = 'slideOut 1s ease-in forwards';
            setTimeout(() => {
                welcomePage.style.display = 'none';
                chatInterface.style.display = 'flex';
                // Proceed with fetching chats
                fetchChats();
            }, 1000); // Match slideOut duration
        }, 3000); // Adjusted to allow time for letter animation and subtext
    }

    showWelcomePage();

    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    fileInput.style.display = 'none';
    document.body.appendChild(fileInput);

    function displaySelectedImage(file) {
        const previewContainer = document.createElement('div');
        previewContainer.className = 'image-preview-container';

        const imgPreview = document.createElement('img');
        imgPreview.className = 'image-preview';
        imgPreview.file = file;

        const removeBtn = document.createElement('button');
        removeBtn.className = 'remove-image-btn';
        removeBtn.innerHTML = '&times;';
        removeBtn.title = 'Remove image';
        removeBtn.addEventListener('click', () => {
            previewContainer.remove();
        });

        previewContainer.appendChild(imgPreview);
        previewContainer.appendChild(removeBtn);

        // Display above the input area
        const inputArea = document.querySelector('.input-area');
        inputArea.insertBefore(previewContainer, inputArea.firstChild);

        // Create a preview of the image
        const reader = new FileReader();
        reader.onload = (e) => { imgPreview.src = e.target.result; };
        reader.readAsDataURL(file);
    }

    // Modify the file upload button event listener
    fileUploadButton.addEventListener('click', () => {
        fileInput.click();
    });

    fileInput.addEventListener('change', (e) => {
        if (fileInput.files && fileInput.files[0]) {
            const file = fileInput.files[0];

            // Check if file is an image
            if (!file.type.startsWith('image/')) {
                alert('Please select an image file (JPEG, PNG, etc.)');
                return;
            }

            // Display the selected image
            displaySelectedImage(file);
        }
    });

    let currentSpeech = null;
    let preferredVoice = null;

    // Load voices and select a female one
    function setPreferredVoice() {
        const voices = window.speechSynthesis.getVoices();

        // Prefer Hindi or Marathi voices
        preferredVoice = voices.find(voice =>
            voice.lang.toLowerCase().includes("hi") ||  // Hindi
            voice.lang.toLowerCase().includes("mr") ||  // Marathi
            voice.name.toLowerCase().includes("hindi") ||
            voice.name.toLowerCase().includes("marathi") ||
            voice.name.toLowerCase().includes("à¤­à¤¾à¤°à¤¤")
        );

        // If not found, fallback to female English voice
        if (!preferredVoice) {
            preferredVoice = voices.find(voice =>
                voice.name.toLowerCase().includes("female") ||
                voice.name.toLowerCase().includes("woman") ||
                voice.name.toLowerCase().includes("zira") ||
                voice.name.toLowerCase().includes("samantha")
            );
        }

        // Fallback: any non-male voice
        if (!preferredVoice) {
            preferredVoice = voices.find(v => !v.name.toLowerCase().includes("male"));
        }

        console.log("Selected voice:", preferredVoice?.name || "None");
    }




    let speechStates = new Map();

    function removeEmojis(text) {
        return text.replace(/[\u{1F600}-\u{1F64F}\u{1F300}-\u{1F5FF}\u{1F680}-\u{1F6FF}\u{1F700}-\u{1F77F}\u{1F780}-\u{1F7FF}\u{1F800}-\u{1F8FF}\u{1F900}-\u{1F9FF}\u{1FA00}-\u{1FA6F}\u{1FA70}-\u{1FAFF}\u{2600}-\u{26FF}\u{2700}-\u{27BF}]/gu, '');
    }

    function toggleSpeech(messageContainer, content) {
        if (!content || typeof content !== 'string') return;

        const messageId = messageContainer.dataset.messageId || Date.now().toString();
        messageContainer.dataset.messageId = messageId;

        const state = speechStates.get(messageId) || { isPlaying: false, currentIndex: 0, utterances: [] };
        const button = messageContainer.querySelector('.speaker-button');

        if (state.isPlaying) {
            speechSynthesis.cancel();
            state.isPlaying = false;
            state.currentIndex = 0;
            state.utterances = [];
            button.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M5 3v18l15-9z" />
            </svg>
        `;
            return;
        }

        const cleanContent = removeEmojis(content);
        const chunks = cleanContent.match(/.{1,200}(?:\s|$)/g);
        if (!chunks) return;

        state.utterances = chunks.map(chunk => {
            const utterance = new SpeechSynthesisUtterance(chunk);
            if (preferredVoice) {
                utterance.voice = preferredVoice;
                utterance.lang = preferredVoice.lang;
            } else {
                utterance.lang = 'hi-IN';
            }
            return utterance;
        });

        state.currentIndex = 0;
        state.isPlaying = true;
        speechStates.set(messageId, state);
        button.innerHTML = `
        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <path d="M10 4v16M14 4v16" />
        </svg>
    `;

        function speakNextChunk() {
            if (!state.isPlaying || state.currentIndex >= state.utterances.length) {
                state.isPlaying = false;
                button.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M5 3v18l15-9z" />
                </svg>
            `;
                return;
            }

            const utterance = state.utterances[state.currentIndex];
            utterance.onend = () => {
                state.currentIndex++;
                setTimeout(speakNextChunk, 100);
            };
            utterance.onerror = (err) => {
                console.error("Speech error:", err);
                state.isPlaying = false;
            };

            speechSynthesis.speak(utterance);
        }

        speechSynthesis.cancel(); // ensure clean start
        setTimeout(() => speakNextChunk(), 100);
    }

    // State for typing effect and stop generation
    let isTyping = false;
    let typingTimeout = null;
    let abortController = null;

    function isMobileDevice() {
        return window.innerWidth <= 768 || /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    // Toggle mobile sidebar
    hamburgerMenu.addEventListener('click', () => {
        mobileSidebar.classList.add('active');
        mobileSidebarOverlay.classList.add('active');
    });

    // User dropdown handling for both mobile and desktop
    const userAccountMobile = document.getElementById('user-account');
    const userDropdownMobile = document.getElementById('user-dropdown');
    const userAccountDesktop = document.getElementById('user-account-01');
    const userDropdownDesktop = document.getElementById('user-dropdown-01');

    // Toggle mobile dropdown
    userAccountMobile.addEventListener('click', (e) => {
        e.stopPropagation();
        userDropdownMobile.classList.toggle('active');
        userDropdownDesktop.classList.remove('active');
    });

    // Toggle desktop dropdown
    userAccountDesktop.addEventListener('click', (e) => {
        e.stopPropagation();
        userDropdownDesktop.classList.toggle('active');
        userDropdownMobile.classList.remove('active');
    });

    // Close both dropdowns on outside click
    document.addEventListener('click', (e) => {
        if (!userAccountMobile.contains(e.target) && !userDropdownMobile.contains(e.target)) {
            userDropdownMobile.classList.remove('active');
        }
        if (!userAccountDesktop.contains(e.target) && !userDropdownDesktop.contains(e.target)) {
            userDropdownDesktop.classList.remove('active');
        }
        // Close context menu on outside click
        const contextMenu = document.querySelector('.context-menu');
        if (contextMenu && !contextMenu.contains(e.target)) {
            contextMenu.remove();
        }
    });

    mobileSidebarOverlay.addEventListener('click', () => {
        mobileSidebar.classList.remove('active');
        mobileSidebarOverlay.classList.remove('active');
    });

    // Handle keyboard show/hide on mobile devices
    function handleKeyboardVisibility() {
        const inputArea = document.querySelector('.input-area');
        let originalHeight = window.innerHeight;

        chatInput.addEventListener('focus', () => {
            setTimeout(() => {
                inputArea.scrollIntoView({ behavior: 'smooth', block: 'end' });
                const newHeight = window.innerHeight;
                if (newHeight < originalHeight) {
                    inputArea.style.bottom = `${originalHeight - newHeight}px`;
                }
            }, 300);
        });

        chatInput.addEventListener('blur', () => {
            inputArea.style.bottom = '0';
        });

        window.addEventListener('resize', () => {
            const newHeight = window.innerHeight;
            if (newHeight > originalHeight) {
                inputArea.style.bottom = '0';
            } else {
                inputArea.style.bottom = `${originalHeight - newHeight}px`;
                inputArea.scrollIntoView({ behavior: 'smooth', block: 'end' });
            }
            originalHeight = newHeight;
        });
    }

    handleKeyboardVisibility();

    // Swipe to open/close
    let touchStartX = 0;
    let touchEndX = 0;

    document.addEventListener('touchstart', (e) => {
        touchStartX = e.changedTouches[0].screenX;
    });

    document.addEventListener('touchend', (e) => {
        touchEndX = e.changedTouches[0].screenX;
        if (touchStartX < 50 && touchEndX - touchStartX > 50) {
            mobileSidebar.classList.add('active');
            mobileSidebarOverlay.classList.add('active');
        } else if (touchStartX - touchEndX > 50) {
            mobileSidebar.classList.remove('active');
            mobileSidebarOverlay.classList.remove('active');
        }
    });

    // Handle mobile new chat button
    mobileNewChatBtn.addEventListener('click', () => {
        if (!activeChat || activeChat.messages.length > 0) {
            createNewChat();
            showChatInterface();
            mobileSidebar.classList.remove('active');
            mobileSidebarOverlay.classList.remove('active');
        } else {
            chatInput.focus();
        }
    });

    togglePinBtn.addEventListener('click', () => {
        expandedMenu.classList.toggle('pinned');
        const main = document.querySelector('.main');
        if (expandedMenu.classList.contains('pinned')) {
            main.classList.add('shifted-left');
        } else {
            main.classList.remove('shifted-left');
        }
    });

    // Chat state
    let currentModel = 'gpt-3.5';
    let allChats = [];
    let activeChat = null;
    let currentSection = 'home';
    const token = getToken(); // Retrieve JWT token

    function getToken() {
        const urlParams = new URLSearchParams(window.location.search);
        let token = urlParams.get('token');
        if (!token) {
            token = localStorage.getItem('jwt_token');
        }
        return token;
    }
    speechSynthesis.onvoiceschanged = setPreferredVoice;
    setPreferredVoice();

    // Fetch chats from backend
    async function fetchChats() {
        try {
            const response = await fetch('http://localhost:3000/api/chats', {
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            if (!response.ok) throw new Error('Failed to fetch chats');
            allChats = await response.json();
            updateChatHistoryUI();

            // Check for stored active chat ID
            const activeChatId = localStorage.getItem('activeChatId');
            let chatToLoad = null;

            // Only try to find chat if ID is valid
            if (activeChatId && activeChatId.match(/^[0-9a-fA-F]{24}$/)) {
                chatToLoad = allChats.find(chat => chat._id === activeChatId);
            }

            if (allChats.length > 0) {
                if (chatToLoad) {
                    // Load the previously active chat
                    loadChat(activeChatId);
                } else {
                    // Fallback to the first chat if the stored ID is invalid
                    loadChat(allChats[0]._id);
                }
            } else {
                createNewChat();
                showChatInterface();
            }
        } catch (error) {
            console.error('Error fetching chats:', error);
            alert('Failed to load chat history. Please try again.');
            createNewChat();
            showChatInterface();
        }
    }

    // Save chat to backend
    async function saveChatToBackend(chat, signal) {
        try {
            const response = await fetch('http://localhost:3000/api/emotional-chat', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${token}`
                },
                body: JSON.stringify({
                    input: chat.messages[chat.messages.length - 1].content,
                    chatId: chat._id || undefined // Only send chatId if it exists
                }),
                signal
            });
            if (!response.ok) throw new Error('Failed to save chat');
            const data = await response.json();
            chat._id = data.chatId;
            chat.messages.push({ role: 'bot', content: data.response });

            // Update activeChatId in localStorage if this is the active chat
            if (activeChat === chat) {
                localStorage.setItem('activeChatId', chat._id);
            }

            return data;
        } catch (error) {
            if (error.name === 'AbortError') {
                throw new Error('Generation stopped by user');
            }
            console.error('Error saving chat:', error);
            throw error;
        }
    }

    // Delete chat from backend
    async function deleteChatFromBackend(chatId) {
        try {
            const response = await fetch(`http://localhost:3000/api/chats/${chatId}`, {
                method: 'DELETE',
                headers: {
                    'Authorization': `Bearer ${token}`
                }
            });
            if (!response.ok) throw new Error('Failed to delete chat');
            return true;
        } catch (error) {
            console.error('Error deleting chat:', error);
            throw error;
        }
    }

    // Update chat history list in the UI
    function updateChatHistoryUI() {
        chatHistoryList.innerHTML = '';
        mobileChatHistoryList.innerHTML = '';

        allChats.forEach(chat => {
            const historyItem = document.createElement('li');
            historyItem.className = `expanded-menu-item ${chat._id === activeChat?._id ? 'active' : ''}`;
            historyItem.dataset.id = chat._id;
            historyItem.style.display = 'flex';
            historyItem.style.flexDirection = 'column';
            historyItem.style.alignItems = 'flex-start';
            historyItem.style.gap = '4px';
            historyItem.style.padding = '10px 16px';
            historyItem.style.cursor = 'pointer';
            historyItem.style.height = '50px';

            const mobileHistoryItem = historyItem.cloneNode(true);

            const clickHandler = () => {
                loadChat(chat._id);
                showChatInterface();
                mobileSidebar.classList.remove('active');
                mobileSidebarOverlay.classList.remove('active');
            };
            historyItem.addEventListener('click', clickHandler);
            mobileHistoryItem.addEventListener('click', clickHandler);

            const titleSpan = document.createElement('span');
            titleSpan.textContent = chat.title || "Untitled Chat";
            titleSpan.style.fontWeight = 'bold';
            titleSpan.style.fontSize = '12px';
            titleSpan.style.width = '100%';

            const mobileTitleSpan = titleSpan.cloneNode(true);

            const lastMsg = chat.messages?.length > 0 ? chat.messages[chat.messages.length - 1].content : 'No messages yet';
            const preview = document.createElement('div');
            preview.textContent = lastMsg.slice(0, 40) + (lastMsg.length > 40 ? '...' : '');
            preview.style.fontSize = '10px';
            preview.style.color = '#666';
            preview.style.width = '100%';

            const mobilePreview = preview.cloneNode(true);

            const deleteBtn = document.createElement('button');
            deleteBtn.className = 'delete-btn';
            deleteBtn.style.alignSelf = 'flex-end';
            deleteBtn.style.marginTop = '-30px';
            deleteBtn.innerHTML = `
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M3 6h18M8 6V4a1 1 0 011-1h6a1 1 0 011 1v2M10 11v6M14 11v6M4 6h16v14a1 1 0 01-1 1H5a1 1 0 01-1-1V6z"/>
                </svg>
            `;
            deleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteChat(chat._id);
            });

            const mobileDeleteBtn = deleteBtn.cloneNode(true);
            mobileDeleteBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                deleteChat(chat._id);
            });

            historyItem.appendChild(titleSpan);
            historyItem.appendChild(preview);
            historyItem.appendChild(deleteBtn);
            chatHistoryList.appendChild(historyItem);

            mobileHistoryItem.appendChild(mobileTitleSpan);
            mobileHistoryItem.appendChild(mobilePreview);
            mobileHistoryItem.appendChild(mobileDeleteBtn);
            mobileChatHistoryList.appendChild(mobileHistoryItem);
        });
    }

    // Delete a chat
    async function deleteChat(chatId) {
        if (!confirm(`Are you sure you want to permanently delete the chat "${allChats.find(c => c._id === chatId).title}"?`)) {
            return;
        }

        try {
            await deleteChatFromBackend(chatId);
            allChats = allChats.filter(chat => chat._id !== chatId);

            if (activeChat && activeChat._id === chatId) {
                // Clear activeChatId from localStorage
                localStorage.removeItem('activeChatId');
                activeChat = null;
                chatArea.innerHTML = '';
                if (allChats.length > 0) {
                    loadChat(allChats[0]._id);
                } else {
                    createNewChat();
                    showChatInterface();
                }
            }

            updateChatHistoryUI();
        } catch (error) {
            alert('Failed to delete chat. Please try again.');
        }
    }

    // Create a new chat
    function createNewChat() {
        const newChat = {
            _id: null,
            title: "New Chat",
            messages: [],
            model: currentModel
        };

        allChats.unshift(newChat);
        activeChat = newChat;
        chatArea.innerHTML = '';
        chatArea.appendChild(welcomeScreen);
        welcomeScreen.style.display = 'flex';
        updateChatHistoryUI();

        // Save the new chat as active (null until saved to backend)
        localStorage.setItem('activeChatId', newChat._id || 'new');

        return newChat._id;
    }

    // Load a specific chat
    // In ChatUI.js
    async function loadChat(chatId) {
        const chat = allChats.find(c => c._id === chatId);
        if (!chat) return;

        activeChat = chat;
        currentModel = chat.model;
        updateModelUI();

        // Save the active chat ID to localStorage
        localStorage.setItem('activeChatId', chatId);

        chatArea.innerHTML = '';
        if (chat.messages.length > 0) {
            welcomeScreen.style.display = 'none';
            chat.messages.forEach(msg => {
                const role = msg.sender === 'user' ? 'user' : 'bot';
                const displayContent = msg.content === "User shared an image." && msg.image ? '' : msg.content;
                addMessageToUI(role, displayContent, false, msg.image);
            });
        } else {
            chatArea.appendChild(welcomeScreen);
            welcomeScreen.style.display = 'flex';
        }

        updateChatHistoryUI();
        if (!isMobileDevice()) {
            chatInput.focus();
        }
    }
    // Update model selection UI
    function updateModelUI() {
        modelOptions.forEach(option => {
            if (option.getAttribute('data-model') === currentModel) {
                option.classList.add('active');
            } else {
                option.classList.remove('active');
            }
        });
    }

    // Rename the current chat based on first message
    function updateChatTitle(newTitle) {
        if (!activeChat) return;
        activeChat.title = newTitle || "New Chat";
        updateChatHistoryUI();
    }

    // Adjust input height based on content
    function adjustInputHeight() {
        chatInput.style.height = 'auto';
        chatInput.style.height = (chatInput.scrollHeight) + 'px';
    }

    // Add a message to the UI with optional typing effect
    // In ChatUI.js, inside addMessageToUI function
    function addMessageToUI(role, content, useTypingEffect = false, imageUrl = null) {
        const messageContainer = document.createElement('div');
        messageContainer.className = `message-container ${role === 'user' ? 'user' : 'bot'}-message`;

        const messageWrapper = document.createElement('div');
        messageWrapper.className = 'message-wrapper';

        const avatar = document.createElement('div');
        avatar.className = 'avatar';

        if (role === 'user') {
            avatar.textContent = '';
        } else if (!isMobileDevice()) {
            avatar.innerHTML = `
            <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                <path d="M12 2L14 10L22 12L14 14L12 22L10 14L2 12L10 10L12 2Z" fill="#4CAF50" stroke="#4CAF50" />
                <path d="M5 3L5.5 5L7 5.5L5.5 6L5 8L4.5 6L3 5.5L4.5 5L5 3Z" fill="#81C784" stroke="#4CAF50" />
                <path d="M17 16L17.3 17.5L18.5 18L17.3 18.5L17 20L16.7 18.5L15.5 18L16.7 17.5L17 16Z" fill="#81C784" stroke="#4CAF50" />
            </svg>
        `;
        }

        const messageContent = document.createElement('div');
        messageContent.className = 'message-content';

        // Add image if it exists (for user messages)
        if (imageUrl && role === 'user') {
            const imgElement = document.createElement('img');
            imgElement.src = imageUrl;
            imgElement.style.maxWidth = '200px'; // Adjust size for chat UI
            imgElement.style.maxHeight = '200px';
            imgElement.style.borderRadius = '8px';
            imgElement.style.marginBottom = '8px';
            messageContent.appendChild(imgElement);
        }

        // Add text content only if it exists
        if (content) {
            if (useTypingEffect && role === 'bot') {
                messageContent.textContent = '';
                let index = 0;
                isTyping = true;

                function typeCharacter() {
                    if (!isTyping || index >= content.length) {
                        isTyping = false;
                        clearTimeout(typingTimeout);
                        return;
                    }
                    messageContent.textContent += content[index];
                    index++;
                    chatArea.scrollTop = chatArea.scrollHeight;
                    typingTimeout = setTimeout(typeCharacter, 20);
                }

                typeCharacter();
            } else {
                messageContent.textContent = content;
            }
        }

        if (avatar.innerHTML || role === 'user') {
            messageWrapper.appendChild(avatar);
        }
        messageWrapper.appendChild(messageContent);
        messageContainer.appendChild(messageWrapper);

        if (role === 'bot') {
            const speakerButton = document.createElement('button');
            speakerButton.className = 'speaker-button';
            speakerButton.title = 'Read Aloud';
            speakerButton.innerHTML = `
            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M3 9v6h4l5 5V4l-5 5H3z" />
                <path d="M16 8c2.2 1.6 2.2 4.4 0 6" />
                <path d="M18 6c3.3 2.4 3.3 5.6 0 8" />
            </svg>
        `;
            speakerButton.addEventListener('click', () => toggleSpeech(messageContainer, content));
            messageContainer.appendChild(speakerButton);
        }

        chatArea.appendChild(messageContainer);
        chatArea.scrollTop = chatArea.scrollHeight;

        return messageContainer;
    }
    // Show context menu for user messages


    // Edit a user message
    function editMessage(messageContainer, originalContent) {
        const messageContent = messageContainer.querySelector('.message-content');
        const input = document.createElement('textarea');
        input.value = originalContent;
        input.style.width = '100%';
        input.style.minHeight = '50px';
        input.style.resize = 'vertical';

        const saveButton = document.createElement('button');
        saveButton.textContent = 'Save';
        saveButton.style.marginTop = '5px';

        messageContent.innerHTML = '';
        messageContent.appendChild(input);
        messageContent.appendChild(saveButton);

        saveButton.addEventListener('click', async () => {
            const editedContent = input.value.trim();
            if (editedContent) {
                // Remove original message from activeChat
                const messageIndex = activeChat.messages.findIndex(msg => msg.content === originalContent && msg.sender === 'user');
                if (messageIndex !== -1) {
                    activeChat.messages.splice(messageIndex, 1);
                }

                // Update UI
                messageContent.textContent = editedContent;
                activeChat.messages.push({ sender: 'user', content: editedContent });
                chatArea.scrollTop = chatArea.scrollHeight;

                // Send edited message as new prompt
                showTypingIndicator();
                abortController = new AbortController();
                try {
                    const response = await fetch('http://localhost:3000/api/emotional-chat', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({
                            input: editedContent,
                            chatId: activeChat._id
                        }),
                        signal: abortController.signal
                    });

                    if (!response.ok) {
                        const errorData = await response.json();
                        throw new Error(errorData.message || 'Failed to get AI response');
                    }

                    const data = await response.json();
                    removeTypingIndicator();

                    if (data.isTechnicalRedirect) {
                        activeChat.messages.push({ sender: 'bot', content: data.response });
                        addMessageToUI('bot', data.response, true);
                    } else {
                        activeChat._id = data.chatId;
                        activeChat.messages.push({ sender: 'bot', content: data.response });
                        addMessageToUI('bot', data.response, true);

                        const chatIndex = allChats.findIndex(c => c === activeChat);
                        if (chatIndex !== -1) {
                            allChats[chatIndex] = activeChat;
                        } else {
                            allChats.unshift(activeChat);
                        }
                        updateChatHistoryUI();
                    }
                } catch (error) {
                    removeTypingIndicator();
                    const errorMessage = `Error: ${error.message}`;
                    activeChat.messages.push({ sender: 'bot', content: errorMessage });
                    addMessageToUI('bot', errorMessage, false);
                    console.error('Error sending edited message:', error);
                }
            }
        });
    }

    // Show typing indicator with stop button
    function showTypingIndicator() {
        const messageContainer = document.createElement('div');
        messageContainer.className = 'message-container bot-message typing-indicator-container';
        messageContainer.id = 'typing-indicator';

        const messageWrapper = document.createElement('div');
        messageWrapper.className = 'message-wrapper';

        const avatar = document.createElement('div');
        avatar.className = 'avatar';

        if (!isMobileDevice()) {
            avatar.innerHTML = `
                <svg width="30" height="30" viewBox="0 0 24 24" fill="none" stroke="#4CAF50" stroke-width="1.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M12 2L14 10L22 12L14 14L12 22L10 14L2 12L10 10L12 2Z" fill="#4CAF50" stroke="#4CAF50" />
                    <path d="M5 3L5.5 5L7 5.5L5.5 6L5 8L4.5 6L3 5.5L4.5 5L5 3Z" fill="#81C784" stroke="#4CAF50" />
                    <path d="M17 16L17.3 17.5L18.5 18L17.3 18.5L17 20L16.7 18.5L15.5 18L16.7 17.5L17 16Z" fill="#81C784"
                        stroke="#4CAF50" />
                </svg>
            `;
        }

        const typingIndicator = document.createElement('div');
        typingIndicator.className = 'message-content';
        typingIndicator.textContent = 'Generating...';



        if (avatar.innerHTML) {
            messageWrapper.appendChild(avatar);
        }
        messageWrapper.appendChild(typingIndicator);
        messageContainer.appendChild(messageWrapper);

        chatArea.appendChild(messageContainer);
        chatArea.scrollTop = chatArea.scrollHeight;
    }

    // Remove typing indicator
    function removeTypingIndicator() {
        const indicator = document.getElementById('typing-indicator');
        if (indicator) {
            indicator.remove();
        }
    }

    // Stop generation
    function stopGeneration() {
        if (abortController) {
            abortController.abort();
            abortController = null;
        }
        isTyping = false;
        clearTimeout(typingTimeout);
        removeTypingIndicator();
        if (currentSpeech) {
            window.speechSynthesis.cancel();
            currentSpeech = null;
            speechStates.forEach((state, messageId) => {
                state.isPlaying = false;
                const container = document.querySelector(`[data-message-id="${messageId}"]`);
                if (container) {
                    const button = container.querySelector('.speaker-button');
                    if (button) {
                        button.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 3v18l15-9z" />
                        </svg>
                    `;
                    }
                }
            });
            speechStates.clear();
        }
        const lastBotMessage = activeChat.messages[activeChat.messages.length - 1];
        if (lastBotMessage && lastBotMessage.role === 'bot' && lastBotMessage.content === '') {
            activeChat.messages.pop();
        }
    }
    // Handle sending a message
    async function sendMessage() {
        const message = chatInput.value.trim();
        const imagePreview = document.querySelector('.image-preview-container');
        let imageUrl = null;
        let file = fileInput.files[0];

        // If there's no message and no image, return
        if (!message && !file) return;

        welcomeScreen.style.display = 'none';
        if (welcomeScreen.parentNode === chatArea) {
            chatArea.removeChild(welcomeScreen);
        }

        // Get image URL if an image is selected
        if (imagePreview && file) {
            const img = imagePreview.querySelector('.image-preview');
            imageUrl = img.src; // Use the data URL from FileReader for now
        }

        // Construct prompt for the backend
        let prompt = message;
        if (file && !message) {
            prompt = "User shared an image."; // Default prompt if only image is provided
        }

        // Add user message to UI (with image if present)
        activeChat.messages.push({ sender: 'user', content: prompt, image: imageUrl });
        // Display the message (if present) and the image (if present)
        const displayContent = message || (imageUrl ? '' : 'Shared an image');
        addMessageToUI('user', displayContent, false, imageUrl);

        // Clear input and image preview
        chatInput.value = '';
        adjustInputHeight();
        if (imagePreview) {
            imagePreview.remove();
        }
        fileInput.value = '';

        if (activeChat.messages.length === 1) {
            const firstFewWords = message ? message.split(' ').slice(0, 5).join(' ') + (message.split(' ').length > 5 ? '...' : '') : 'Image shared';
            updateChatTitle(firstFewWords);
        }

        showTypingIndicator();
        abortController = new AbortController();

        try {
            const formData = new FormData();
            formData.append('input', prompt);
            if (file) {
                formData.append('image', file);
            }
            formData.append('chatId', activeChat._id);

            const response = await fetch('http://localhost:3000/api/emotional-chat', {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${token}`
                },
                body: formData,
                signal: abortController.signal
            });

            if (!response.ok) {
                const errorData = await response.json();
                throw new Error(errorData.message || 'Failed to get AI response');
            }

            const data = await response.json();
            removeTypingIndicator();

            // Update the image URL with the one returned from the backend (if available)
            if (data.imageUrl) {
                const lastUserMessage = activeChat.messages[activeChat.messages.length - 1];
                if (lastUserMessage.sender === 'user' && lastUserMessage.image) {
                    lastUserMessage.image = data.imageUrl; // Update with the backend URL
                    // Update the UI to reflect the new image URL
                    const lastMessageContainer = chatArea.lastElementChild;
                    if (lastMessageContainer && lastMessageContainer.classList.contains('user-message')) {
                        const imgElement = lastMessageContainer.querySelector('.message-content img');
                        if (imgElement) {
                            imgElement.src = data.imageUrl;
                        }
                    }
                }
            }

            if (data.isTechnicalRedirect) {
                activeChat.messages.push({ sender: 'bot', content: data.response });
                addMessageToUI('bot', data.response, true);
            } else {
                activeChat._id = data.chatId;
                activeChat.messages.push({ sender: 'bot', content: data.response });
                addMessageToUI('bot', data.response, true);

                const chatIndex = allChats.findIndex(c => c === activeChat);
                if (chatIndex !== -1) {
                    allChats[chatIndex] = activeChat;
                } else {
                    allChats.unshift(activeChat);
                }
                updateChatHistoryUI();
            }

            // Handle happy moments if returned
            if (data.happyMomentStored) {
                console.log('Happy moment stored:', data.happyMomentStored);
            }
            if (data.pastHappyMoments && data.pastHappyMoments.length > 0) {
                const pastMomentsMessage = "I noticed you might be feeling down. Here are some happy moments to lift your spirits:\n" +
                    data.pastHappyMoments.map(m => `- ${m.content} (${new Date(m.date).toLocaleDateString()})`).join('\n');
                activeChat.messages.push({ sender: 'bot', content: pastMomentsMessage });
                addMessageToUI('bot', pastMomentsMessage, true);
            }
        } catch (error) {
            removeTypingIndicator();
            const errorMessage = `Error: ${error.message}`;
            activeChat.messages.push({ sender: 'bot', content: errorMessage });
            addMessageToUI('bot', errorMessage, false);
            console.error('Error sending message:', error);
        } finally {
            abortController = null;
        }
    }


    // Show chat interface
    function showChatInterface() {
        currentSection = 'home';
        updateNavUI();
        pageContent.innerHTML = '';
        pageContent.appendChild(chatInterface);
        if (activeChat) {
            loadChat(activeChat._id);
        } else {
            createNewChat();
        }
    }

    // Show DreamSpace page
    function showDreamSpacePage() {
        currentSection = 'dream-space';
        updateNavUI();
pageContent.innerHTML = `
    <div class="model-selector">
        <div class="model-option active" data-model="noira" id="NoiraModel" style='background-color:white;'>Noira</div>
    </div>
`;



        mobileSidebar.classList.remove('active');
        mobileSidebarOverlay.classList.remove('active');

        // âœ… Add click listeners for dynamically injected buttons
        const noiraModel = document.getElementById('NoiraModel');
        const dreamCraftModel = document.getElementById('DreamCraftModel');

        noiraModel.addEventListener('click', () => {
            showChatInterface(); // Your home/chat UI
            updateModelUI();
        });

        dreamCraftModel.addEventListener('click', () => {
            showDreamSpacePage(); // Re-initialize
            updateModelUI();
        });
    }


    // Show SoulSafe page
function showSoulSafePage() {
    currentSection = 'soul-safe';
    updateNavUI();

   pageContent.innerHTML = `
    <div class="model-selector">
        <div class="model-option active" data-model="noira" id="NoiraModel">Noira</div>
    </div>


    <div class="soulsafe-page">
        <h2>SoulSafe: Your Happy Moments</h2>
        <p>A treasure chest of your happiest memories.</p>
        <div class="moments-container" id="moments-container"></div>
    </div>
    `;

    // Sample data for moments (combined from all sources)
    const happyMoments = JSON.parse(localStorage.getItem('happyMoments')) || [
        { type: "dreamcraft", content: "Image Creation", image: "https://via.placeholder.com/150", date: "2025-05-10" },
        { type: "dreamcraft", content: "Comic Book", image: "https://via.placeholder.com/150?text=Comic+Book", date: "2025-05-12" },
        { type: "story", content: "A heartwarming story about friendship.", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3", date: "2025-05-11" },
        { type: "story", content: "A thrilling adventure tale!", audio: "https://www.soundhelix.com/examples/mp3/SoundHelix-Song-2.mp3", date: "2025-05-13" },
        { type: "chatai", content: "AI: Youâ€™re doing great today! Keep it up!", date: "2025-05-09" },
        { type: "chatai", content: "User: I had a tough day... AI: Iâ€™m here for you!", date: "2025-05-14" }
    ];

    // Icons for each moment type
    const icons = {
        dreamcraft: `<svg class="moment-icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
            <path d="M12 2L14 10L22 12L14 14L12 22L10 14L2 12L10 10L12 2Z" />
        </svg>`,
        story: `<svg class="moment-icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
            <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2h11A2.5 2.5 0 0 1 20 4.5v15a2 2 0 0 1-1.3 1.9 2 2 0 0 1-2.2-.4l-2.5-2.1-2.5 2.1a2 2 0 0 1-2.5 0l-2.5-2.1-2.5 2.1A2 2 0 0 1 4 19.5z"/>
        </svg>`,
        chatai: `<svg class="moment-icon" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/>
        </svg>`
    };

    // Function to create a flip card for a moment
    function createMomentCard(moment) {
        const card = document.createElement('div');
        card.className = 'moment-card';

        const momentTitle = moment.type === 'dreamcraft' ? moment.content :
                           moment.type === 'story' ? 'Story Moment' : 'Chat Moment';

        card.innerHTML = `
        <div class="moment-card-inner">
            <!-- Front Face -->
            <div class="moment-card-front">
                ${icons[moment.type]}
                <h4>${momentTitle}</h4>
                <small>${new Date(moment.date).toLocaleDateString()}</small>
            </div>
            <!-- Back Face -->
            <div class="moment-card-back">
                <h4>${momentTitle}</h4>
                <small>${new Date(moment.date).toLocaleDateString()}</small>
                ${
                    moment.type === 'dreamcraft' ? `<img src="${moment.image}" alt="${moment.content}"/>` :
                    moment.type === 'story' ? `
                        <p>${moment.content}</p>
                        <audio controls><source src="${moment.audio}" type="audio/mp3">Your browser does not support the audio element.</audio>
                    ` :
                    `<p>${moment.content}</p>`
                }
            </div>
        </div>
        `;

        card.addEventListener('click', () => {
            const inner = card.querySelector('.moment-card-inner');
            const isFlipped = inner.style.transform === 'rotateY(180deg)';
            inner.style.transform = isFlipped ? 'rotateY(0deg)' : 'rotateY(180deg)';
        });

        return card;
    }

    // Render all moments in a single section
    const momentsContainer = document.getElementById('moments-container');
    if (happyMoments.length === 0) {
        momentsContainer.innerHTML = '<p class="no-moments">No happy moments yet.</p>';
    } else {
        happyMoments.forEach(moment => {
            const card = createMomentCard(moment);
            momentsContainer.appendChild(card);
        });
    }

    mobileSidebar.classList.remove('active');
    mobileSidebarOverlay.classList.remove('active');

    // Add event listeners for dynamically injected model buttons
    const noiraModel = document.getElementById('NoiraModel');
    const dreamCraftModel = document.getElementById('DreamCraftModel');

    noiraModel.addEventListener('click', () => {
        showChatInterface();
        updateModelUI();
    });

    dreamCraftModel.addEventListener('click', () => {
        showDreamSpacePage();
        updateModelUI();
    });
}


    // Update navigation UI
    function updateNavUI() {
        navLinks.forEach(link => {
            const section = link.getAttribute('data-section');
            if (section === currentSection) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }

    // Event Listeners
    chatInput.addEventListener('input', adjustInputHeight);
    sendButton.addEventListener('click', sendMessage);
    chatInput.addEventListener('keydown', (e) => {
        if (e.key === 'Enter' && !e.shiftKey) {
            e.preventDefault();
            sendMessage();
        }
    });
modelOptions.forEach(option => {
    option.addEventListener('click', () => {
        modelOptions.forEach(opt => opt.classList.remove('active'));
        option.classList.add('active');

        const selectedModel = option.getAttribute('data-model');
        if (selectedModel === 'noira') {
            currentModel = 'noira';
            showChatInterface();
        }

        if (activeChat) {
            activeChat.model = currentModel;
        }
    });
});

    addBtn.addEventListener('click', () => {
        if (!activeChat || activeChat.messages.length > 0) {
            createNewChat();
            showChatInterface();
            if (!isMobileDevice()) {
                chatInput.focus();
            }
        } else {
            if (!isMobileDevice()) {
                chatInput.focus();
            }
        }
    });

    exampleCards.forEach(card => {
        card.addEventListener('click', () => {
            const exampleText = card.querySelector('.example-title').textContent;
            chatInput.value = exampleText;
            adjustInputHeight();
            chatInput.focus();
        });
    });

navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
        const section = link.getAttribute('data-section');
        if (section === 'home') {
            e.preventDefault();
            showChatInterface();
        } else if (section === 'soul-safe') {
            e.preventDefault();
            showSoulSafePage();
        }
        // Remove dream-space case since it's handled by href
    });
});

    // Add this at the top of your ChatUI.js with other DOM element declarations
    const micOverlay = document.getElementById('mic-overlay');
    const micIcon = document.getElementById('mic-icon');
    const micStatus = document.getElementById('mic-status');
    const micStopButton = document.getElementById('mic-stop-button');

    // Add this with your other state variables
    let recognition = null;
    let isListening = false;
    let silenceTimeout = null;
    const SILENCE_DURATION = 3000; // Stop listening after 3 seconds of silence

    // Function to initialize speech recognition
    function initializeSpeechRecognition() {
        if (!('webkitSpeechRecognition' in window) && !('SpeechRecognition' in window)) {
            alert('Speech recognition is not supported in your browser. Try Chrome or Edge.');
            return false;
        }

        const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
        recognition = new SpeechRecognition();

        recognition.continuous = true; // Changed to true for continuous listening
        recognition.interimResults = true;
        recognition.lang = 'en-US'; // Default language, can be changed based on user preference

        recognition.onstart = () => {
            isListening = true;
            micIcon.classList.add('listening');
            micStatus.textContent = 'Listening...';
        };

        recognition.onerror = (event) => {
            console.error('Speech recognition error', event.error);
            if (event.error === 'no-speech') {
                micStatus.textContent = 'No speech detected';
                stopListening();
            } else {
                micStatus.textContent = `Error: ${event.error}`;
                stopListening();
            }
        };

        recognition.onend = () => {
            if (isListening) {
                // Restart recognition to continue listening
                try {
                    recognition.start();
                } catch (error) {
                    console.error('Failed to restart recognition:', error);
                    stopListening();
                }
            } else {
                stopListening();
            }
        };

        recognition.onresult = (event) => {
            const transcript = Array.from(event.results)
                .map(result => result[0])
                .map(result => result.transcript)
                .join('');

            // Reset silence timeout on receiving any result
            clearTimeout(silenceTimeout);
            silenceTimeout = setTimeout(() => {
                if (isListening) {
                    micStatus.textContent = 'No speech detected';
                    stopListening();
                }
            }, SILENCE_DURATION);

            // Update status with interim or final results
            if (event.results[event.results.length - 1].isFinal) {
                chatInput.value = transcript;
                adjustInputHeight();
                micStatus.textContent = 'Processing...';
                // Optionally stop listening after final result
                // stopListening(); // Uncomment if you want to stop after each final result
            } else {
                micStatus.textContent = `Listening: ${transcript}`;
            }
        };

        return true;
    }

    // Add this function to start listening
    function startListening() {
        if (!recognition && !initializeSpeechRecognition()) {
            return;
        }

        micOverlay.classList.add('active');
        try {
            recognition.start();
            // Start silence detection
            silenceTimeout = setTimeout(() => {
                if (isListening) {
                    micStatus.textContent = 'No speech detected';
                    stopListening();
                }
            }, SILENCE_DURATION);
        } catch (error) {
            console.error('Speech recognition start failed:', error);
            micStatus.textContent = 'Failed to start listening';
            stopListening();
        }
    }

    // Add this function to stop listening
    function stopListening() {
        isListening = false;
        if (recognition) {
            try {
                recognition.stop();
            } catch (error) {
                console.error('Error stopping recognition:', error);
            }
        }
        clearTimeout(silenceTimeout);
        micIcon.classList.remove('listening');
        micOverlay.classList.remove('active');
        micStatus.textContent = 'Tap microphone to start';
    }

    // Update the micButton event listener
    micButton.addEventListener('click', () => {
        if (isListening) {
            stopListening();
        } else {
            startListening();
        }
    });
    micOverlay.addEventListener('click', (e) => {
        // Only stop listening if clicking outside the mic-container
        if (e.target === micOverlay) {
            stopListening();
        }
    });
    // Add event listener for the stop button in the overlay
    micStopButton.addEventListener('click', stopListening);

    voiceAssistantButton.addEventListener('click', () => {
        alert('Voice Assistant feature is not implemented yet.');
    });

    // Initialize
    function initializeApp() {


        // Use an account-specific key for hasSeenWelcome
        const welcomeKey = `hasSeenWelcome_${userEmail}`;
        const hasSeenWelcome = localStorage.getItem(welcomeKey);

        if (!hasSeenWelcome) {
            // Show welcome page for the first time after login
            showWelcomePage();
            // Set flag to prevent showing again until logout
            localStorage.setItem(welcomeKey, 'true');
        } else {
            // Skip welcome page and show chat interface directly
            chatInterface.style.display = 'flex';
            fetchChats();
        }

       
    }


    // Profile Picture Selection
    const profilePictureOptions = document.getElementById('profile-picture-options');
    const profilePicturePreview = document.getElementById('profile-picture-preview');

    // Default profile pictures (replace with your own image URLs)
    const defaultProfilePictures = [
        '\static\image\G-1.jpg',
        '\static\image\G-2.jpg',
        '\static\image\M1.jpg',
        '\static\image\m2.jpg',
        '\static\image\new1.jpg',
        '\static\image\new2.jpg',
    ];

    // Populate profile picture options
    function populateProfilePictures() {
        defaultProfilePictures.forEach((src, index) => {
            const img = document.createElement('img');
            img.src = src;
            img.className = 'profile-picture-option';
            img.dataset.index = index;
            img.alt = `Profile Picture ${index + 1}`;
            profilePictureOptions.appendChild(img);

            img.addEventListener('click', () => {
                // Remove active class from all options
                document.querySelectorAll('.profile-picture-option').forEach(opt => {
                    opt.classList.remove('active');
                });
                // Add active class to selected option
                img.classList.add('active');
                // Update preview
                profilePicturePreview.src = src;
                localStorage.setItem('profilePicture', src);
            });
        });

        // Set default profile picture (first one or saved one)
        const savedPicture = localStorage.getItem('profilePicture');
        if (savedPicture && defaultProfilePictures.includes(savedPicture)) {
            profilePicturePreview.src = savedPicture;
            const activeOption = document.querySelector(`.profile-picture-option[src="${savedPicture}"]`);
            if (activeOption) activeOption.classList.add('active');
        } else {
            profilePicturePreview.src = defaultProfilePictures[0];
            document.querySelector('.profile-picture-option[data-index="0"]').classList.add('active');
        }
    }

    // Call this function when initializing preferences
    populateProfilePictures();



    function setupButtonGroup(buttons, onSelect) {
        buttons.forEach(button => {
            button.addEventListener('click', () => {
                buttons.forEach(btn => btn.classList.remove('active'));
                button.classList.add('active');
                if (onSelect) onSelect(button.dataset.value);
            });
        });
    }

    setupButtonGroup(genderButtons);
    setupButtonGroup(assistantButtons, value => {
        currentModel = value; // Update assistant type
    });
    setupButtonGroup(languageButtons, value => {
        if (recognition) {
            recognition.lang = value === 'en' ? 'en-US' : value === 'hi' ? 'hi-IN' : 'mr-IN';
        }
    });

    // Close modal
    function closeModal() {
        personalizeModal.classList.remove('active');
        successMessage.style.display = 'none';
        errorMessage.style.display = 'none';
    }
    personalizeModal.addEventListener('click', (e) => {
        if (e.target === personalizeModal) {
            closeModal();
        }
    });
    closeModalButton.addEventListener('click', closeModal);
    cancelPreferencesButton.addEventListener('click', closeModal);

    // Close modal when clicking outside
    personalizeModal.addEventListener('click', (e) => {
        if (e.target === personalizeModal) {
            closeModal();
        }
    });

    // Save preferences
    savePreferencesButton.addEventListener('click', () => {
        const name = userNameInput.value.trim();
        const gender = Array.from(genderButtons).find(btn => btn.classList.contains('active'))?.dataset.value || '';
        const assistantType = Array.from(assistantButtons).find(btn => btn.classList.contains('active'))?.dataset.value || '';
        const language = Array.from(languageButtons).find(btn => btn.classList.contains('active'))?.dataset.value || '';
        const profilePicture = profilePicturePreview.src;

        // Validate all fields
        if (!name || !gender || !assistantType || !language || !profilePicture) {
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
            return;
        }

        // Validate name
        if (!/^[a-zA-Z\s]{1,50}$/.test(name)) {
            errorMessage.textContent = 'Please enter a valid name (letters and spaces only, up to 50 characters).';
            errorMessage.style.display = 'block';
            successMessage.style.display = 'none';
            return;
        }

        // Apply assistant type
        currentModel = assistantType;

        // Apply language for speech recognition
        if (recognition && language) {
            recognition.lang = language === 'en' ? 'en-US' : language === 'hi' ? 'hi-IN' : 'mr-IN';
        }

        // Save to localStorage
        localStorage.setItem('userName', name);
        localStorage.setItem('gender', gender);
        localStorage.setItem('assistantType', assistantType);
        localStorage.setItem('language', language);
        localStorage.setItem('profilePicture', profilePicture);

        // Update user account images
        document.querySelectorAll('.user-account img').forEach(img => {
            img.src = profilePicture;
        });

        // Show success message
        successMessage.style.display = 'block';
        errorMessage.style.display = 'none';

        // Close modal after 2 seconds
        setTimeout(closeModal, 2000);
    });
    // Load saved preferences on initialization
    function loadPreferences() {
        const name = localStorage.getItem('userName') || '';
        const gender = localStorage.getItem('gender') || '';
        const assistantType = localStorage.getItem('assistantType') || 'female';
        const language = localStorage.getItem('language') || 'en';
        const profilePicture = localStorage.getItem('profilePicture') || defaultProfilePictures[0];

        userNameInput.value = name;
        profilePicturePreview.src = profilePicture;

        genderButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.value === gender));
        assistantButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.value === assistantType));
        languageButtons.forEach(btn => btn.classList.toggle('active', btn.dataset.value === language));

        // Apply preferences
        currentModel = assistantType;
        if (recognition) {
            recognition.lang = language === 'en' ? 'en-US' : language === 'hi' ? 'hi-IN' : 'mr-IN';
        }
    }

    // Call loadPreferences after initializeApp
    initializeApp();
    loadPreferences();


    // Initialize
    fetchChats();

    function handleLogout() {
        // Clear the welcome page flag
        localStorage.removeItem('hasSeenWelcome');
        // Clear JWT token or other session data
        localStorage.removeItem('jwt_token');
        // Redirect to login page
        window.location.href = 'loginPage.html';
    }




});
</script>
</html>